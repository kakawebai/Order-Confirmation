<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO 快速排名指南 - KGR 关键词黄金比例实战工具</title>
    <meta name="description" content="利用 Keyword Golden Ratio (KGR) 关键词黄金比例实现新站快速排名。包含 SEO 全链路流程解析、KGR 自动计算器及关键词竞争度分析工具。">
    <meta name="keywords" content="SEO快速排名, KGR公式, 关键词黄金比例, 谷歌SEO工具, 搜索排名优化">
    
    <link rel="preconnect" href="https://cdn.bootcdn.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="//trends.google.com">
    <link rel="dns-prefetch" href="//ssl.gstatic.com">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kakaciro.dpdns.org/seo-kuaisu-paiming.html">
    <meta property="og:title" content="SEO 快速排名指南 - KGR 实战工具">
    <meta property="og:description" content="利用 KGR 黄金比例实现新站快速排名，包含自动计算工具。">
    <meta property="og:image" content="https://kakaciro.dpdns.org/seo-og-image.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://kakaciro.dpdns.org/seo-kuaisu-paiming.html">
    <meta property="twitter:title" content="SEO 快速排名指南">
    <meta property="twitter:description" content="利用 KGR 黄金比例实现新站快速排名，包含自动计算工具。">
    <meta property="twitter:image" content="https://kakaciro.dpdns.org/seo-og-image.jpg">

    <link rel="canonical" href="https://kakaciro.dpdns.org/seo-kuaisu-paiming.html">
    <meta name="robots" content="index, follow">
    <link rel="preload" href="css/main.min.css" as="style" fetchpriority="high">
    <link rel="stylesheet" href="css/main.min.css" fetchpriority="high">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" fetchpriority="low" media="print" onload="this.media='all'">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet" fetchpriority="low" media="print" onload="this.media='all'">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .hover-scale { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-scale:hover { transform: translateY(-5px) scale(1.02); }
        .nav-item.active { background-color: #2563eb; color: white; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4); }

        section { content-visibility: auto; contain-intrinsic-size: 1200px 800px; }
        
        /* Top Navigation */
        .top-nav {
            background-color: #fff;
            border-bottom: 1px solid #e2e8f0;
            padding: 0 40px;
            display: flex;
            justify-content: center;
            height: 60px;
            align-items: center;
            gap: 40px;
            flex-shrink: 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .top-nav-item {
            text-decoration: none;
            color: #666;
            font-size: 15px;
            font-weight: 500;
            height: 100%;
            display: flex;
            align-items: center;
            position: relative;
            transition: color 0.3s;
        }

        .top-nav-item:hover {
            color: #2563eb;
        }

        .top-nav-item.active {
            color: #2563eb;
        }

        .top-nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #2563eb;
        }

        @media (max-width: 640px) {
            .top-nav {
                padding: 0 10px;
                gap: 15px;
                height: 50px;
            }
            .top-nav-item {
                font-size: 13px;
            }
            header#hero {
                padding-top: 3rem !important;
                padding-bottom: 3rem !important;
            }
            header#hero h1 {
                font-size: 2.25rem !important; /* text-4xl */
                line-height: 2.5rem !important;
                margin-bottom: 1.5rem !important;
            }
            header#hero p {
                font-size: 1.125rem !important; /* text-lg */
            }
            section h2 {
                font-size: 1.5rem !important; /* text-2xl */
            }
            section h3 {
                font-size: 1.25rem !important; /* text-xl */
            }
            .p-10 {
                padding: 1.5rem !important;
            }
            .text-2xl {
                font-size: 1.25rem !important;
            }
            .text-3xl {
                font-size: 1.5rem !important;
            }
            .text-4xl {
                font-size: 1.75rem !important;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 leading-relaxed">
    <nav class="top-nav">
        <a href="index.html" class="top-nav-item">订单清单</a>
        <a href="dianhuahaoma.html" class="top-nav-item">电话区号</a>
        <a href="instagram-liuliang-quanjiexi.html" class="top-nav-item">Instagram 流量全解析</a>
        <a href="facebook-guanggao.html" class="top-nav-item">Facebook 广告</a>
        <a href="seo-kuaisu-paiming.html" class="top-nav-item active">SEO 快速排名</a>
    </nav>

    <!-- Fixed Left Navigation -->
    <nav class="fixed left-6 top-1/2 -translate-y-1/2 z-50 hidden xl:block">
        <div class="bg-white/80 backdrop-blur-md border border-gray-100 p-3 rounded-3xl shadow-2xl space-y-4">
            <a href="#hero" class="nav-item group flex items-center justify-center w-12 h-12 rounded-2xl transition-all duration-300 hover:bg-blue-600 hover:text-white text-gray-400 bg-gray-50">
                <i class="fas fa-rocket"></i>
                <span class="absolute left-16 bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap">SEO 概览</span>
            </a>
            <a href="#workflow" class="nav-item group flex items-center justify-center w-12 h-12 rounded-2xl transition-all duration-300 hover:bg-cyan-600 hover:text-white text-gray-400 bg-gray-50">
                <i class="fas fa-project-diagram"></i>
                <span class="absolute left-16 bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap">全链路流程</span>
            </a>
            <a href="#formula" class="nav-item group flex items-center justify-center w-12 h-12 rounded-2xl transition-all duration-300 hover:bg-indigo-600 hover:text-white text-gray-400 bg-gray-50">
                <i class="fas fa-square-root-variable"></i>
                <span class="absolute left-16 bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap">KGR 公式</span>
            </a>
            <a href="#ranges" class="nav-item group flex items-center justify-center w-12 h-12 rounded-2xl transition-all duration-300 hover:bg-emerald-600 hover:text-white text-gray-400 bg-gray-50">
                <i class="fas fa-layer-group"></i>
                <span class="absolute left-16 bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap">判定范围</span>
            </a>
            <a href="#calculator" class="nav-item group flex items-center justify-center w-12 h-12 rounded-2xl transition-all duration-300 hover:bg-amber-500 hover:text-white text-gray-400 bg-gray-50">
                <i class="fas fa-calculator"></i>
                <span class="absolute left-16 bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap">KGR 计算器</span>
            </a>
            <a href="#insights" class="nav-item group flex items-center justify-center w-12 h-12 rounded-2xl transition-all duration-300 hover:bg-rose-500 hover:text-white text-gray-400 bg-gray-50">
                <i class="fas fa-lightbulb"></i>
                <span class="absolute left-16 bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap">优势与局限</span>
            </a>
            <a href="#best-practices" class="nav-item group flex items-center justify-center w-12 h-12 rounded-2xl transition-all duration-300 hover:bg-violet-600 hover:text-white text-gray-400 bg-gray-50">
                <i class="fas fa-star"></i>
                <span class="absolute left-16 bg-gray-900 text-white px-3 py-1 rounded-lg text-xs font-bold opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap">最佳实践</span>
            </a>
        </div>
    </nav>

    <!-- Mobile Bottom Navigation -->
    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 xl:hidden w-[90%] max-w-md">
        <div class="bg-white/90 backdrop-blur-lg border border-gray-100 p-2 rounded-2xl shadow-2xl flex justify-around items-center">
            <a href="#workflow" class="flex flex-col items-center p-2 text-gray-400 hover:text-blue-600 transition-colors">
                <i class="fas fa-project-diagram text-lg"></i>
                <span class="text-xs font-bold mt-1">流程</span>
            </a>
            <a href="#formula" class="flex flex-col items-center p-2 text-gray-400 hover:text-indigo-600 transition-colors">
                <i class="fas fa-square-root-variable text-lg"></i>
                <span class="text-xs font-bold mt-1">公式</span>
            </a>
            <a href="#calculator" class="flex flex-col items-center p-2 text-gray-400 hover:text-amber-500 transition-colors">
                <i class="fas fa-calculator text-lg"></i>
                <span class="text-xs font-bold mt-1">工具</span>
            </a>
            <a href="#best-practices" class="flex flex-col items-center p-2 text-gray-400 hover:text-violet-600 transition-colors">
                <i class="fas fa-star text-lg"></i>
                <span class="text-xs font-bold mt-1">实践</span>
            </a>
        </div>
    </nav>

    <!-- Hero Section -->
    <header id="hero" class="relative pt-12 md:pt-20 pb-20 md:pb-32 overflow-hidden">
        <div class="absolute inset-0 z-0">
            <div class="absolute top-0 right-0 w-[300px] md:w-[500px] h-[300px] md:h-[500px] bg-blue-100/50 rounded-full blur-3xl -mr-32 md:-mr-64 -mt-32 md:-mt-64"></div>
            <div class="absolute bottom-0 left-0 w-[200px] md:w-[400px] h-[200px] md:h-[400px] bg-indigo-100/50 rounded-full blur-3xl -ml-24 md:-ml-48 -mb-24 md:-mb-48"></div>
        </div>
        
        <div class="max-w-6xl mx-auto px-4 relative z-10 text-center">
            <div class="inline-flex items-center space-x-2 bg-blue-50 border border-blue-100 px-4 py-2 rounded-full text-blue-600 text-xs md:text-sm font-black mb-6 md:mb-8 uppercase tracking-widest animate-bounce">
                <i class="fas fa-bolt"></i>
                <span>Fast Ranking Strategy</span>
            </div>
            <h1 class="text-4xl md:text-8xl font-black text-slate-900 mb-6 md:mb-8 tracking-tighter">
                SEO <span class="text-blue-600">快速排名</span>指南
            </h1>
            <p class="text-lg md:text-2xl text-slate-500 font-bold max-w-3xl mx-auto leading-relaxed">
                利用 <span class="text-slate-900">Keyword Golden Ratio (KGR)</span> 关键词黄金比例，
                在 48 小时内让你的新站出现在搜索结果前 100 名。
            </p>
            <div class="mt-8 md:mt-12 flex justify-center space-x-4">
                <div class="px-6 py-2 bg-slate-900 text-white rounded-full text-xs md:text-sm font-black uppercase tracking-widest">三九英雄出品</div>
            </div>
        </div>
    </header>

    <!-- SEO Workflow Section -->
    <section id="workflow" class="max-w-7xl mx-auto px-4 mb-20 md:mb-32">
        <div class="text-center mb-10 md:16">
            <h2 class="text-3xl md:text-4xl font-black text-slate-900 mb-4">SEO 核心全链路流程</h2>
            <p class="text-slate-500 font-bold text-sm md:text-base">从爬行到转化的完整生命周期</p>
            <div class="w-20 md:w-24 h-2 bg-blue-600 mx-auto rounded-full mt-4"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
            <!-- Step 1: Crawling -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-blue-50 rounded-2xl flex items-center justify-center text-blue-600 text-xl group-hover:bg-blue-600 group-hover:text-white transition-all">
                        <i class="fas fa-spider"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">1. 爬行 (Crawling)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-blue-50 text-blue-600 text-sm font-bold rounded-full border border-blue-100">外链引流</span>
                    <span class="px-3 py-1 bg-blue-50 text-blue-600 text-sm font-bold rounded-full border border-blue-100">市面上有蜘蛛池</span>
                </div>
                <p class="text-slate-500 text-sm font-bold leading-relaxed">
                    是指搜索引擎的爬虫(蜘蛛)通过访问互联网上的网页并跟踪页面之间的链接，从而收集网页数据的过程。这是搜索引擎在更新其索引之前进行的第一步操作。
                </p>
            </div>

            <!-- Step 2: Scraping -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-indigo-50 rounded-2xl flex items-center justify-center text-indigo-600 text-xl group-hover:bg-indigo-600 group-hover:text-white transition-all">
                        <i class="fas fa-download"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">2. 抓取 (Scraping)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-indigo-50 text-indigo-600 text-sm font-bold rounded-full border border-indigo-100">有大量蜘蛛爬行就有抓取页面</span>
                </div>
                <p class="text-slate-500 text-sm font-bold leading-relaxed">
                    是指搜索引擎或其他程序通过其爬虫(蜘蛛)访问网页并提取网页内容的过程。抓取是搜索引擎在构建和更新索引时进行的核心步骤。简单来说抓取是爬虫"抓取"网页的内容，将其存储或传递给搜索引擎进行进一步分析。
                </p>
            </div>

            <!-- Step 3: Collection -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-violet-50 rounded-2xl flex items-center justify-center text-violet-600 text-xl group-hover:bg-violet-600 group-hover:text-white transition-all">
                        <i class="fas fa-box-archive"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">3. 收录 (Collection)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-violet-50 text-violet-600 text-sm font-bold rounded-full border border-violet-100">评估 (质量审核)</span>
                    <span class="px-3 py-1 bg-violet-50 text-violet-600 text-sm font-bold rounded-full border border-violet-100">网页被搜索引擎发现并存储</span>
                </div>
                <p class="text-slate-500 text-base font-bold leading-relaxed">
                    收录是指搜索引擎抓取到的页面存储到其数据库中，意味着它知道这个页面的存在。
                </p>
                <div class="mt-3 p-4 bg-violet-50 rounded-2xl border border-violet-100">
                    <p class="text-sm font-bold text-violet-700">
                        关键点：如果网页被抓取了但没被收录，通常是因为内容质量低、标签设置了 noindex，或者存在严重的重复问题。
                    </p>
                </div>
            </div>

            <!-- Step 4: Indexing -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-purple-50 rounded-2xl flex items-center justify-center text-purple-600 text-xl group-hover:bg-purple-600 group-hover:text-white transition-all">
                        <i class="fas fa-database"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">4. 索引 (Indexing)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-purple-50 text-purple-600 text-sm font-bold rounded-full border border-purple-100">有收录页面不一定有索引</span>
                    <span class="px-3 py-1 bg-purple-50 text-purple-600 text-sm font-bold rounded-full border border-purple-100">索引后参与到排名机制赋展现机会</span>
                </div>
                <p class="text-slate-500 text-base font-bold leading-relaxed">
                    是指搜索引擎将抓取到的网页进行处理和分析，并将其数据存储在搜索引挚的数据库中，准备为用户的搜索查询提供相关结果。索引是搜索引擎的核心部分，它决定了哪些网页将出现在搜索结果中，以及它们的展示顺序。
                </p>
                <div class="mt-3 p-4 bg-purple-50 rounded-2xl border border-purple-100">
                    <p class="text-sm font-bold text-purple-700">
                        关键点：索引就是关键词、质量进行分类。索引是排名（Ranking）的前提。不入库，就永远不可能有排名。
                    </p>
                </div>
            </div>

            <!-- Step 5: Ranking -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col md:col-span-2">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-emerald-50 rounded-2xl flex items-center justify-center text-emerald-600 text-xl group-hover:bg-emerald-600 group-hover:text-white transition-all">
                        <i class="fas fa-award"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">5. 排名 (Ranking)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-6">
                    <span class="px-3 py-1 bg-emerald-50 text-emerald-600 text-sm font-bold rounded-full border border-emerald-100">关键词</span>
                    <span class="px-3 py-1 bg-emerald-50 text-emerald-600 text-sm font-bold rounded-full border border-emerald-100">匹配相关性</span>
                    <span class="px-3 py-1 bg-emerald-50 text-emerald-600 text-sm font-bold rounded-full border border-emerald-100">页面质量</span>
                    <span class="px-3 py-1 bg-emerald-50 text-emerald-600 text-sm font-bold rounded-full border border-emerald-100">用户体验 (UX)</span>
                    <span class="px-3 py-1 bg-emerald-50 text-emerald-600 text-sm font-bold rounded-full border border-emerald-100">外链</span>
                    <span class="px-3 py-1 bg-emerald-50 text-emerald-600 text-sm font-bold rounded-full border border-emerald-100">内链调优</span>
                    <span class="px-3 py-1 bg-emerald-50 text-emerald-600 text-sm font-bold rounded-full border border-emerald-100">域名权重</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- 1. 关键词 -->
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col">
                        <h4 class="font-black text-slate-900 mb-2 text-sm uppercase tracking-wider flex items-center">
                            <i class="fas fa-key mr-2 text-emerald-500"></i>关键词
                        </h4>
                        <div class="flex flex-wrap gap-2 mt-2">
                     <span class="px-3 py-1 bg-white border border-slate-200 rounded text-sm text-slate-600 font-bold">匹配相关性</span>
                     <span class="px-3 py-1 bg-white border border-slate-200 rounded text-sm text-slate-600 font-bold">标题</span>
                     <span class="px-3 py-1 bg-white border border-slate-200 rounded text-sm text-slate-600 font-bold">描述</span>
                     <span class="px-3 py-1 bg-white border border-slate-200 rounded text-sm text-slate-600 font-bold">文案内容</span>
                     <span class="px-3 py-1 bg-white border border-slate-200 rounded text-sm text-slate-600 font-bold">URL－链接尾缀相关性</span>
                     <span class="px-3 py-1 bg-white border border-slate-200 rounded text-sm text-slate-600 font-bold">关键词竞争度 (流量大小, 困难度KD)</span>
                 </div>
                    </div>

                    <!-- 2. 匹配相关性 -->
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col">
                        <h4 class="font-black text-slate-900 mb-2 text-sm uppercase tracking-wider flex items-center">
                            <i class="fas fa-link mr-2 text-emerald-500"></i>匹配相关性
                        </h4>
                        <p class="text-slate-500 text-sm font-bold leading-relaxed">搜索引擎会根据用户的查询关键词与网页内容的匹配程度来决定页面的相关性。页面内容中包含了用户查询的关键词，并且能够准确回应查询意图，排名往往会更高。</p>
                    </div>

                    <!-- 3. 页面质量 -->
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col">
                        <h4 class="font-black text-slate-900 mb-2 text-sm uppercase tracking-wider flex items-center">
                            <i class="fas fa-file-alt mr-2 text-emerald-500"></i>页面质量
                        </h4>
                        <p class="text-slate-500 text-sm font-bold leading-relaxed">页面是否原创、有用、信息丰富、无语法错误，都会影响排名。搜索引擎更倾向于展示内容高质量、易于用户理解且提供实际价值的页面。</p>
                    </div>

                    <!-- 4. 用户体验 (UX) -->
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col">
                        <h4 class="font-black text-slate-900 mb-2 text-sm uppercase tracking-wider flex items-center">
                            <i class="fas fa-user-check mr-2 text-emerald-500"></i>用户体验 (UX)
                        </h4>
                        <p class="text-slate-500 text-sm font-bold leading-relaxed">页面加载速度、易用性、设计和可访问性都会影响排名。搜索引擎希望用户访问页面后能够快速找到所需信息，因此对这些因素有很高的要求。移动端适配和响应式设计对排名有重要影响，尤其是随着移动设备流量的增加。</p>
                    </div>

                    <!-- 5. 外链 -->
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col">
                        <h4 class="font-black text-slate-900 mb-2 text-sm uppercase tracking-wider flex items-center">
                            <i class="fas fa-external-link-alt mr-2 text-emerald-500"></i>外链
                        </h4>
                        <p class="text-slate-500 text-sm font-bold leading-relaxed">高质量的外部链接是搜索引擎评估网页权威性的重要指标。来自权威站点的链接（比如行业领袖网站、媒体报道等）能够大幅提升网页排名。反向链接的质量和数量都对排名有很大影响，但垃圾链接（比如购买链接）可能会被搜索引擎惩罚。</p>
                    </div>

                    <!-- 6. 内链调优 -->
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col">
                        <h4 class="font-black text-slate-900 mb-2 text-sm uppercase tracking-wider flex items-center">
                            <i class="fas fa-sitemap mr-2 text-emerald-500"></i>内链调优
                        </h4>
                        <div class="space-y-3">
                            <p class="text-slate-500 text-sm font-bold leading-relaxed">
                                网站多个页面或者产品、内容指向要排名的链接。
                            </p>
                            <div class="grid grid-cols-1 gap-2">
                                <div class="p-3 bg-white/60 rounded-xl border border-emerald-100/50">
                                    <p class="text-[11px] font-black text-emerald-700 mb-1 flex items-center">
                                        <i class="fas fa-tint mr-1.5 text-[10px]"></i>提升 SEO 权重传递 (Link Juice)
                                    </p>
                                    <p class="text-[11px] text-slate-500 font-bold leading-relaxed">内链可以像“管道”一样，将高权重页面（如首页）能量传递给深层页面，帮助新页面更快获得排名。</p>
                                </div>
                                <div class="p-3 bg-white/60 rounded-xl border border-emerald-100/50">
                                    <p class="text-[11px] font-black text-emerald-700 mb-1 flex items-center">
                                        <i class="fas fa-spider mr-1.5 text-[10px]"></i>优化抓取与收录
                                    </p>
                                    <p class="text-[11px] text-slate-500 font-bold leading-relaxed">搜索引擎蜘蛛通过链接爬行。合理的内链结构能确保蜘蛛发现所有页面，防止出现“孤岛页面”。</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 7. 域名权重 -->
                    <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100 flex flex-col lg:col-span-3">
                        <h4 class="font-black text-slate-900 mb-2 text-sm uppercase tracking-wider flex items-center">
                            <i class="fas fa-globe mr-2 text-emerald-500"></i>域名权重
                        </h4>
                        <p class="text-slate-500 text-sm font-bold leading-relaxed">搜索引擎会考虑网站的历史和总体权威性。例如，拥有高权重的域名（老站、知名品牌）通常会在相关查询中获得更好的排名。</p>
                    </div>

                </div>
            </div>

            <!-- Step 6: Impression -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-amber-50 rounded-2xl flex items-center justify-center text-amber-600 text-xl group-hover:bg-amber-600 group-hover:text-white transition-all">
                        <i class="fas fa-eye"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">6. 展现 (Impression)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-amber-50 text-amber-600 text-sm font-bold rounded-full border border-amber-100">索引后排名</span>
                </div>
                <div class="space-y-3">
                    <p class="text-slate-500 text-base font-bold leading-relaxed">
                        展现是指你的网页在搜索结果页面（SERP）中被用户看到的次数。
                    </p>
                    <div class="p-5 bg-amber-50 rounded-2xl border border-amber-100">
                        <p class="text-sm font-bold text-amber-700 leading-relaxed">
                            <span class="text-base">搜索需求量 (Search Volume)：</span>如果你排在第一名，但这个词一个月都没人搜，那么你的展现量依然是 0。
                        </p>
                        <div class="mt-3 grid grid-cols-1 gap-3">
                            <div class="flex items-start">
                                <i class="fas fa-exclamation-triangle mt-1 mr-2 text-amber-500 text-xs"></i>
                                <p class="text-sm text-amber-600 font-bold">无人问津的小词：排名第一也没用（无流量）。</p>
                            </div>
                            <div class="flex items-start">
                                <i class="fas fa-exclamation-triangle mt-1 mr-2 text-amber-500 text-xs"></i>
                                <p class="text-sm text-amber-600 font-bold">竞争激烈的“大词”：流量巨大但你挤不进去（无排名）。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 7: Click -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-orange-50 rounded-2xl flex items-center justify-center text-orange-600 text-xl group-hover:bg-orange-600 group-hover:text-white transition-all">
                        <i class="fas fa-mouse-pointer"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">7. 点击 (Click)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-orange-50 text-orange-600 text-sm font-bold rounded-full border border-orange-100">吸引点击用户 -> 排名/标题/描述...等等</span>
                </div>

                <div class="mt-4 space-y-3">
                    <!-- Item 1: Ranking -->
                    <div class="group p-4 bg-orange-50/20 rounded-2xl border border-orange-100/30 hover:bg-orange-50/50 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-white rounded-lg shadow-sm flex items-center justify-center text-orange-600">
                                    <i class="fas fa-trophy text-xs"></i>
                                </div>
                                <div>
                                    <h4 class="text-sm font-black text-slate-900 leading-none">排名 (Ranking)</h4>
                                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-wider mt-1">基础盘</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-base font-black text-orange-600">70%</span>
                                <div class="w-12 h-1 bg-slate-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-orange-500 w-[70%]"></div>
                                </div>
                            </div>
                        </div>
                        <p class="text-[11px] text-slate-500 font-bold leading-tight">
                            <span class="text-orange-600">核心逻辑：</span>依靠内容质量、外链、内链、技术 SEO 提权
                        </p>
                    </div>

                    <!-- Item 2: Title -->
                    <div class="group p-4 bg-orange-50/20 rounded-2xl border border-orange-100/30 hover:bg-orange-50/50 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-white rounded-lg shadow-sm flex items-center justify-center text-orange-500">
                                    <i class="fas fa-heading text-xs"></i>
                                </div>
                                <div>
                                    <h4 class="text-sm font-black text-slate-900 leading-none">标题 (Title)</h4>
                                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-wider mt-1">爆点</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-base font-black text-orange-500">20%</span>
                                <div class="w-12 h-1 bg-slate-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-orange-400 w-[20%]"></div>
                                </div>
                            </div>
                        </div>
                        <p class="text-[11px] text-slate-500 font-bold leading-tight">
                            <span class="text-orange-500">核心逻辑：</span>关键词匹配 + 好奇心/利益诱导
                        </p>
                    </div>

                    <!-- Item 3: Description -->
                    <div class="group p-4 bg-orange-50/20 rounded-2xl border border-orange-100/30 hover:bg-orange-50/50 transition-all duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-white rounded-lg shadow-sm flex items-center justify-center text-orange-400">
                                    <i class="fas fa-align-left text-xs"></i>
                                </div>
                                <div>
                                    <h4 class="text-sm font-black text-slate-900 leading-none">元描述 (Description)</h4>
                                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-wider mt-1">说服力</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="text-base font-black text-orange-400">10%</span>
                                <div class="w-12 h-1 bg-slate-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-orange-300 w-[10%]"></div>
                                </div>
                            </div>
                        </div>
                        <p class="text-[11px] text-slate-500 font-bold leading-tight">
                            <span class="text-orange-400">核心逻辑：</span>解决用户痛点 + 呼吁行动 (CTA)
                        </p>
                    </div>
                </div>
            </div>

            <!-- Step 8: Traffic -->
            <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 hover-scale group flex flex-col md:col-span-2">
                <div class="flex items-center space-x-4 mb-6">
                    <div class="w-14 h-14 bg-rose-50 rounded-2xl flex items-center justify-center text-rose-600 text-xl group-hover:bg-rose-600 group-hover:text-white transition-all">
                        <i class="fas fa-chart-pie"></i>
                    </div>
                    <h3 class="text-2xl font-black text-slate-900">8. 流量 (Traffic)</h3>
                </div>
                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="px-3 py-1 bg-rose-50 text-rose-600 text-sm font-bold rounded-full border border-rose-100">用户行为 -> 停留、访问多个页面、加购、收藏、支付、链接跳转咨询</span>
                </div>
                <p class="text-slate-500 text-base font-bold leading-relaxed">
                    解决用户意图流量慢慢上升。
                </p>

                <div class="mt-8 pt-6 border-t border-rose-100">
                    <div class="bg-gradient-to-br from-rose-50 to-white rounded-3xl p-6 border border-rose-100 shadow-inner">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-10 h-10 bg-rose-500 rounded-xl flex items-center justify-center text-white shadow-lg shadow-rose-200">
                                <i class="fas fa-star text-sm"></i>
                            </div>
                            <span class="text-lg font-black text-slate-900">核心总结</span>
                        </div>
                        <p class="text-rose-800 font-black text-sm md:text-base leading-relaxed mb-4">
                            要明白什么是搜索引擎SEO基础原理顺序：
                        </p>
                        <div class="flex flex-wrap items-center gap-y-3">
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-white rounded-lg shadow-sm border border-rose-100 text-rose-600 font-black text-sm">爬行</span>
                                <i class="fas fa-arrow-right mx-2 text-rose-200 text-xs"></i>
                            </div>
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-white rounded-lg shadow-sm border border-rose-100 text-rose-600 font-black text-sm">抓取</span>
                                <i class="fas fa-arrow-right mx-2 text-rose-200 text-xs"></i>
                            </div>
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-white rounded-lg shadow-sm border border-rose-100 text-rose-600 font-black text-sm">收录</span>
                                <i class="fas fa-arrow-right mx-2 text-rose-200 text-xs"></i>
                            </div>
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-white rounded-lg shadow-sm border border-rose-100 text-rose-600 font-black text-sm">索引</span>
                                <i class="fas fa-arrow-right mx-2 text-rose-200 text-xs"></i>
                            </div>
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-white rounded-lg shadow-sm border border-rose-100 text-rose-600 font-black text-sm">排名</span>
                                <i class="fas fa-arrow-right mx-2 text-rose-200 text-xs"></i>
                            </div>
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-white rounded-lg shadow-sm border border-rose-100 text-rose-600 font-black text-sm">展现</span>
                                <i class="fas fa-arrow-right mx-2 text-rose-200 text-xs"></i>
                            </div>
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-white rounded-lg shadow-sm border border-rose-100 text-rose-600 font-black text-sm">点击</span>
                                <i class="fas fa-arrow-right mx-2 text-rose-200 text-xs"></i>
                            </div>
                            <div class="flex items-center">
                                <span class="px-3 py-1 bg-rose-500 rounded-lg shadow-md border border-rose-400 text-white font-black text-sm">流量</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- KGR Formula Section -->
    <section id="formula" class="max-w-5xl mx-auto px-4 mb-20 md:mb-32">
        <div class="bg-indigo-600 rounded-[2.5rem] md:rounded-[3rem] p-6 md:p-12 text-white relative overflow-hidden shadow-2xl shadow-indigo-200">
            <div class="absolute top-0 right-0 p-12 opacity-10 hidden md:block">
                <i class="fas fa-square-root-variable text-[200px] rotate-12"></i>
            </div>
            <div class="relative z-10 text-center">
                <h2 class="text-2xl md:text-3xl font-black mb-6 md:mb-8 uppercase tracking-widest">KGR 计算公式</h2>
                <div class="bg-white/10 backdrop-blur-md border border-white/20 rounded-2xl md:rounded-3xl p-6 md:p-10 inline-block w-full md:w-auto">
                    <div class="text-2xl md:text-6xl font-black tracking-tighter mb-4 flex flex-col md:flex-row items-center justify-center gap-2">
                        <span>KGR =</span>
                        <span class="border-b-2 md:border-b-4 border-white pb-1 md:pb-2 px-2 md:px-4">allintitle:结果数量</span>
                    </div>
                    <div class="text-lg md:text-4xl font-bold opacity-80">
                        月搜索量
                    </div>
                </div>
                <p class="mt-6 md:mt-8 text-indigo-100 font-bold text-xs md:text-base max-w-2xl mx-auto leading-relaxed">
                    加上关键词搜索等于搜索结果数量（allintitle:关键词 ）核心逻辑是找到那些搜索量适中但“完全匹配”竞争对手极少的关键词。
                </p>
            </div>
        </div>
    </section>

    <!-- KGR Ranges Section -->
    <section id="ranges" class="max-w-6xl mx-auto px-4 mb-20 md:mb-32">
        <div class="text-center mb-10 md:mb-16">
            <p class="text-slate-500 font-bold text-sm md:text-base mb-6 max-w-3xl mx-auto leading-relaxed">
                利用工具通过分析搜索结果前 10 名网页的 <span class="text-blue-600">外链数量（Referring Domains）</span> 和 <span class="text-blue-600">域名权重（DA/DR）</span> 来计算尽力争取排名
            </p>
            <h2 class="text-3xl md:text-4xl font-black text-slate-900 mb-4">KGR 判定范围与潜力</h2>
            <div class="w-20 md:w-24 h-2 bg-blue-600 mx-auto rounded-full"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
            <!-- Range 1: High Potential -->
            <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border border-emerald-100 hover-scale relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-emerald-50 rounded-bl-[4rem] flex items-center justify-center">
                    <span class="text-3xl font-black text-emerald-500">1</span>
                </div>
                <div class="w-16 h-16 bg-emerald-500 rounded-2xl flex items-center justify-center text-white text-2xl mb-8 shadow-lg shadow-emerald-200">
                    <i class="fas fa-check-double"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-900 mb-4">KGR < 0.25</h3>
                <p class="text-emerald-600 font-black text-sm uppercase tracking-widest mb-4">效果极佳 (简单)</p>
                <p class="text-slate-500 text-base font-bold leading-relaxed">
                    极高潜力进入搜索结果前 100 名。一旦内容索引，排名通常会迅速攀升。
                </p>
            </div>

            <!-- Range 2: Good Chance -->
            <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border border-amber-100 hover-scale relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-amber-50 rounded-bl-[4rem] flex items-center justify-center">
                    <span class="text-3xl font-black text-amber-500">2</span>
                </div>
                <div class="w-16 h-16 bg-amber-500 rounded-2xl flex items-center justify-center text-white text-2xl mb-8 shadow-lg shadow-amber-200">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-900 mb-4">0.25 - 1.00</h3>
                <p class="text-amber-600 font-black text-sm uppercase tracking-widest mb-4">效果良好 (有机会)</p>
                <p class="text-slate-500 text-base font-bold leading-relaxed">
                    有较好机会进入前 250 名。虽然竞争稍强，但对于优质内容仍有很大空间。
                </p>
            </div>

            <!-- Range 3: Competitive -->
            <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border border-rose-100 hover-scale relative overflow-hidden">
                <div class="absolute top-0 right-0 w-24 h-24 bg-rose-50 rounded-bl-[4rem] flex items-center justify-center">
                    <span class="text-3xl font-black text-rose-500">3</span>
                </div>
                <div class="w-16 h-16 bg-rose-500 rounded-2xl flex items-center justify-center text-white text-2xl mb-8 shadow-lg shadow-rose-200">
                    <i class="fas fa-times"></i>
                </div>
                <h3 class="text-2xl font-black text-slate-900 mb-4">KGR > 1.00</h3>
                <p class="text-rose-600 font-black text-sm uppercase tracking-widest mb-4">竞争激烈 (困难)</p>
                <p class="text-slate-500 text-base font-bold leading-relaxed">
                    关键词极其卷。即使搜索量低，也面临大量已优化的对手，很难快速排名。
                </p>
            </div>
        </div>
    </section>

    <!-- KGR Calculator -->
    <section id="calculator" class="max-w-5xl mx-auto px-4 mb-20 md:mb-32">
        <div class="bg-white rounded-[2rem] md:rounded-[3rem] shadow-2xl border border-slate-100 overflow-hidden">
            <div class="bg-slate-900 p-6 md:p-8 text-center text-white">
                <h2 class="text-2xl md:text-3xl font-black flex items-center justify-center">
                    <i class="fas fa-calculator mr-4 text-blue-400"></i> KGR 在线计算器
                </h2>
                <p class="text-slate-400 font-bold text-[10px] md:text-sm mt-2 uppercase tracking-widest">Real-time KGR Analysis</p>
            </div>
            
            <div class="p-6 md:p-12">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
                    <!-- Inputs -->
                    <div class="space-y-6">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="w-1 h-6 bg-blue-600 rounded-full"></div>
                            <h3 class="font-black text-slate-900 text-lg">输入分析参数</h3>
                        </div>
                        
                        <div>
                            <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2">关键词 (可选)</label>
                            <input type="text" id="kgrKeyword" oninput="debounceFetchKgrAllintitle()" placeholder="输入你要分析的关键词..." class="w-full bg-slate-50 border-2 border-slate-100 rounded-xl md:rounded-2xl px-4 py-3 md:py-4 font-bold text-slate-700 outline-none focus:border-blue-500 transition-all text-sm md:text-base">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2 flex justify-between items-center">
                                    Allintitle 结果数
                                    <span id="allintitleLoadingIcon" class="hidden text-blue-500 text-[10px] font-bold"><i class="fas fa-spinner fa-spin mr-1"></i> 获取中...</span>
                                </label>
                                <input type="number" id="allintitle" oninput="calculateKGR()" class="w-full bg-slate-50 border-2 border-slate-100 rounded-xl md:rounded-2xl px-4 py-3 md:py-4 font-black text-slate-900 outline-none focus:border-blue-500 transition-all text-sm md:text-base" value="10">
                            </div>
                            <div>
                                <label class="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2">月搜索量 (Max 250)</label>
                                <input type="number" id="volume" oninput="calculateKGR()" class="w-full bg-slate-50 border-2 border-slate-100 rounded-xl md:rounded-2xl px-4 py-3 md:py-4 font-black text-slate-900 outline-none focus:border-blue-500 transition-all text-sm md:text-base" value="200">
                            </div>
                        </div>
                    </div>

                    <!-- Results -->
                    <div class="bg-slate-50 rounded-[2rem] md:rounded-[2.5rem] p-6 md:p-8 border border-slate-100 flex flex-col items-center justify-center text-center">
                        <p class="text-[10px] md:text-sm font-black text-slate-400 uppercase tracking-widest mb-2 md:mb-4">当前 KGR 得分</p>
                        <div id="kgrResult" class="text-6xl md:text-8xl font-black text-blue-600 tracking-tighter mb-4">0.05</div>
                        <div id="kgrStatus" class="px-6 md:px-8 py-2 md:py-3 rounded-full font-black text-xs md:text-sm bg-emerald-500 text-white shadow-lg shadow-emerald-200 mb-4 md:mb-6">
                            潜力极佳 - 立即行动！
                        </div>
                        <p id="kgrAdvice" class="text-slate-500 font-bold text-xs md:text-base">
                            该关键词竞争非常小，只要内容质量过关，排名指日可待。
                        </p>
                    </div>
                </div>

                <!-- Keyword Research Table -->
                <div class="mt-10 md:mt-12 border-t border-slate-100 pt-10 md:pt-12 px-0 md:px-8 pb-8 md:pb-12">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8">
                        <div class="flex items-start space-x-3">
                            <div class="w-1 h-6 bg-orange-500 rounded-full mt-1"></div>
                            <div>
                                <h3 class="font-black text-slate-900 text-lg">关键词研究清单</h3>
                                <span class="text-[10px] font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-md uppercase tracking-tighter block mt-1">双击单元格编辑内容</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2 md:space-x-3">
                            <button onclick="openImportModal()" class="flex-1 md:flex-none bg-indigo-500 hover:bg-indigo-600 text-white px-3 md:px-4 py-2 rounded-xl text-[10px] md:text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-indigo-200 flex items-center justify-center" title="批量导入关键词数据">
                                <i class="fas fa-file-import mr-2 text-sm"></i> 导入
                            </button>
                            <button onclick="exportToXLSX()" class="flex-1 md:flex-none bg-emerald-500 hover:bg-emerald-600 text-white px-3 md:px-4 py-2 rounded-xl text-[10px] md:text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-emerald-200 flex items-center justify-center">
                                <i class="fas fa-file-excel mr-2 text-sm"></i> 导出
                            </button>
                            <button onclick="openAllintitleConfigModal()" class="flex-1 md:flex-none bg-slate-900 hover:bg-slate-800 text-white px-3 md:px-4 py-2 rounded-xl text-[10px] md:text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-slate-200 flex items-center justify-center" title="配置 Allintitle 自动获取">
                                <i class="fas fa-gear mr-2"></i> Allintitle API
                            </button>
                            <button onclick="addTableRow()" class="flex-1 md:flex-none bg-orange-500 hover:bg-orange-600 text-white px-3 md:px-4 py-2 rounded-xl text-[10px] md:text-xs font-black uppercase tracking-widest transition-all shadow-lg shadow-orange-200 flex items-center justify-center">
                                <i class="fas fa-plus mr-2"></i> 添加
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto rounded-2xl md:rounded-[2rem] border border-slate-100 shadow-sm">
                        <table class="w-full text-left border-collapse" id="kgrTable">
                            <thead>
                                <tr class="bg-orange-500 text-white">
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs">关键词</th>
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs text-center">搜索量</th>
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs text-center">搜索意图</th>
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs text-center">CPC</th>
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs text-center">KD %</th>
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs text-center">
                                        Allintitle 结果数
                                        <span class="ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full bg-blue-100 text-blue-600 text-[8px] cursor-help" title="数据来源：Google Official Custom Search API (实时/严格去重)">
                                            <i class="fas fa-check"></i>
                                        </span>
                                    </th>
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs text-center">KGR</th>
                                    <th class="px-6 py-5 font-black uppercase tracking-widest text-xs text-center">操作</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-50">
                                <tr class="hover:bg-slate-50 transition-colors">
                                    <td contenteditable="true" class="px-6 py-5 font-bold text-slate-700 outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">example keyword</td>
                                    <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all table-volume">250</td>
                                    <td contenteditable="true" class="px-6 py-5 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">Informational</td>
                                    <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">$1.20</td>
                                    <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">25%</td>
                                    <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all table-allintitle">15</td>
                                    <td class="px-6 py-5 text-center table-kgr">
                            <span class="px-3 py-1 bg-emerald-500 text-white rounded-lg text-[10px] font-black">0.06</span>
                        </td>
                        <td class="px-6 py-5 text-center">
                    <div class="flex items-center justify-center space-x-2">
                        <button onclick="openGoogleSearchForRow(this)" class="text-indigo-400 hover:text-indigo-600 transition-colors" title="Google 搜索验证">
                            <i class="fab fa-google"></i>
                        </button>
                        <button onclick="openGoogleTrendsForRow(this)" class="text-sky-500 hover:text-sky-700 transition-colors" title="Google 趋势">
                            <i class="fas fa-chart-line"></i>
                        </button>
                        <button onclick="confirmDelete(this)" class="text-rose-400 hover:text-rose-600 transition-colors" title="删除">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </td>
                    </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3 text-left px-1">
                        <p class="text-sm font-bold text-slate-600 flex items-center justify-start">
                            <i class="fas fa-server mr-2"></i>
                            Allintitle 结果数 是直接通过代码向 Google 官方的 Custom Search JSON API ( googleapis.com ) 发起请求获取的。
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Insights Section -->
    <section id="insights" class="max-w-6xl mx-auto px-4 mb-32">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
            <!-- Benefits -->
            <div class="space-y-8">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-2xl flex items-center justify-center text-xl shadow-inner">
                        <i class="fas fa-plus"></i>
                    </div>
                    <h2 class="text-3xl font-black text-slate-900">KGR 的核心优势</h2>
                </div>
                <div class="space-y-4">
                    <div class="flex items-start space-x-4 p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover-scale">
                        <i class="fas fa-search-dollar text-blue-500 mt-1"></i>
                        <div>
                            <h4 class="font-black text-slate-900 mb-1">精准锁定蓝海</h4>
                            <p class="text-slate-500 text-sm font-bold">避开大站锋芒，快速找到几乎没有竞争的精准词。</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4 p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover-scale">
                        <i class="fas fa-chart-line text-blue-500 mt-1"></i>
                        <div>
                            <h4 class="font-black text-slate-900 mb-1">新站冷启动神器</h4>
                            <p class="text-slate-500 text-sm font-bold">为新网站提供数据支持，让第一波流量来得更快。</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4 p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover-scale">
                        <i class="fas fa-bullseye text-blue-500 mt-1"></i>
                        <div>
                            <h4 class="font-black text-slate-900 mb-1">优先级排序</h4>
                            <p class="text-slate-500 text-sm font-bold">不再凭感觉选词，通过数据量化内容创作的优先级。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Limitations -->
            <div class="space-y-8">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-rose-100 text-rose-600 rounded-2xl flex items-center justify-center text-xl shadow-inner">
                        <i class="fas fa-minus"></i>
                    </div>
                    <h2 class="text-3xl font-black text-slate-900">注意局限性</h2>
                </div>
                <div class="space-y-4">
                    <div class="flex items-start space-x-4 p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover-scale">
                        <i class="fas fa-database text-rose-500 mt-1"></i>
                        <div>
                            <h4 class="font-black text-slate-900 mb-1">数据依赖性</h4>
                            <p class="text-slate-500 text-sm font-bold">月搜索量数据可能存在滞后或不准确。</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4 p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover-scale">
                        <i class="fas fa-robot text-rose-500 mt-1"></i>
                        <div>
                            <h4 class="font-black text-slate-900 mb-1">非唯一指标</h4>
                            <p class="text-slate-500 text-sm font-bold">忽略了权重（DA/DR）、反向链接等其他排名因素。</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4 p-6 bg-white rounded-3xl border border-slate-100 shadow-sm hover-scale">
                        <i class="fas fa-keyboard text-rose-500 mt-1"></i>
                        <div>
                            <h4 class="font-black text-slate-900 mb-1">内容僵化风险</h4>
                            <p class="text-slate-500 text-sm font-bold">过度追求 KGR 可能导致内容生硬或关键词堆砌。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Best Practices Section -->
    <section id="best-practices" class="max-w-6xl mx-auto px-4 mb-32">
        <div class="bg-slate-900 rounded-[3rem] p-12 text-white relative overflow-hidden shadow-2xl">
            <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
            <div class="relative z-10">
                <h2 class="text-3xl font-black mb-8 text-center uppercase tracking-widest">SEO 最佳实践核心</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">1</div>
                        <p class="font-bold">结合其他 SEO 工具（Ahrefs, Semrush）使用</p>
                    </div>
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">2</div>
                        <p class="font-bold">核心聚焦于：用户搜索意图 (Intent)</p>
                    </div>
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">3</div>
                        <p class="font-bold">创造真正解决用户痛点的高质量内容</p>
                    </div>
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">4</div>
                        <p class="font-bold">保持更新：SEO 是持久战而非闪击战</p>
                    </div>
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">5</div>
                        <p class="font-bold">页面标题 (Title) 优化</p>
                    </div>
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">6</div>
                        <p class="font-bold">元描述 (Meta Description) 完善</p>
                    </div>
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">7</div>
                        <p class="font-bold">关键词 (Keywords) 设置</p>
                    </div>
                    <div class="flex items-center space-x-4 bg-white/10 p-6 rounded-2xl border border-white/10">
                        <div class="w-10 h-10 bg-blue-500 rounded-xl flex items-center justify-center font-black">8</div>
                        <p class="font-bold">规范URL (Canonical URL)</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div id="allintitleConfigModal" class="fixed inset-0 z-[100] hidden" style="z-index: 1900;" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeAllintitleConfigModal()"></div>
        <div id="trendsModalScroller" class="absolute inset-0" style="overflow-y:auto;">
            <div class="min-h-full flex items-start justify-center p-4 md:p-6">
                <div class="w-11/12 max-w-md">
                    <div class="bg-white rounded-[2rem] shadow-2xl border border-slate-100 overflow-hidden">
                        <div class="flex items-center justify-between gap-4 px-6 py-5 border-b border-slate-100">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-slate-900 rounded-2xl flex items-center justify-center">
                                    <i class="fas fa-magnifying-glass text-white"></i>
                                </div>
                                <div class="leading-tight">
                                    <div class="text-sm font-black text-slate-900">Google 官方数据配置 (Allintitle)</div>
                                    <div class="text-[11px] font-bold text-slate-500">密钥仅保存到本机浏览器</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <a href="google_API_Key.html" target="_blank" rel="noreferrer" class="h-10 px-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-black text-[10px] uppercase tracking-widest transition-all inline-flex items-center justify-center">获取key</a>
                                <button type="button" onclick="closeAllintitleConfigModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-black transition-all" aria-label="关闭">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="p-6 space-y-4">
                            <label class="flex items-center gap-3 bg-slate-50 border border-slate-100 rounded-2xl px-4 py-3">
                                <input id="allintitleEnabledInput" type="checkbox" class="w-4 h-4" />
                                <span class="text-xs font-black text-slate-700 uppercase tracking-widest">启用关键词输入后自动获取</span>
                            </label>
                            <div>
                                <div class="text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Google API Key</div>
                                <input id="allintitleApiKeyInput" type="password" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl px-4 py-3 font-black text-slate-900 outline-none focus:border-slate-900 transition-all text-sm" placeholder="粘贴你的 API Key" autocomplete="off" />
                            </div>
                            <div>
                                <div class="text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Programmable Search Engine ID (cx)</div>
                                <input id="allintitleCxInput" type="text" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl px-4 py-3 font-black text-slate-900 outline-none focus:border-slate-900 transition-all text-sm" placeholder="例如：012345678901234567890:abcdefg_hij" autocomplete="off" />
                            </div>

                            <div class="mt-4 p-3 bg-indigo-50/50 rounded-lg border border-indigo-100/50">
                                <div class="flex items-start space-x-2">
                                    <div class="mt-0.5 text-indigo-500">
                                        <i class="fas fa-info-circle text-xs"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="text-sm font-bold text-indigo-900 mb-1">为什么 API 结果与网页搜索不同？</h4>
                                        <p class="text-xs text-indigo-800/80 leading-relaxed">
                                            1. <strong>网页端严重虚高</strong>：Google 网页搜索顶部的 "About X results" 是极不准确的估算值。您可以尝试在网页端翻页到最后一页，通常会发现实际结果远少于显示的估算值（例如显示 121 条，翻页后实际只有 40 条）。
                                            <br>
                                            2. <strong>API 更精准</strong>：API 返回的数据剔除了大量重复、无效和“省略的结果”，代表了<strong>真实的有效索引量</strong>。对于 KGR 计算，API 数据更具参考价值，因为它反映了真正的竞争对手数量。
                                            <br>
                                            3. <strong>关键配置</strong>：如果 API 结果极少（个位数），请务必检查 CSE 控制台中是否开启了 "Search the entire web"（搜索整个网络）。
                                            <br>
                                            <span class="opacity-75">* 本工具已配置为全球无过滤搜索 (safe=off)，以获取尽可能多的结果。</span>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-2 p-3 bg-amber-50/50 rounded-lg border border-amber-100/50">
                                <div class="flex items-start space-x-2">
                                    <div class="mt-0.5 text-amber-500">
                                        <i class="fas fa-exclamation-triangle text-xs"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="text-sm font-bold text-amber-900 mb-1">关于 API 配额限制</h4>
                                        <p class="text-xs text-amber-800/80 leading-relaxed">
                                            Google Custom Search API 免费版通常限制每天 <strong>100 次</strong>查询。
                                            <br>
                                            如果遇到 "Quota exceeded" 或 "Quota Limit" 错误，说明今日配额已用完。您可以更换新的 API Key 或等待次日重置。
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div id="allintitleConfigHint" class="hidden text-rose-600 text-sm font-bold"></div>
                        </div>
                        <div class="px-6 pb-8">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button type="button" onclick="closeAllintitleConfigModal()" class="flex-1 px-6 py-4 rounded-2xl bg-slate-100 hover:bg-slate-200 text-slate-600 font-black text-xs uppercase tracking-widest transition-all">取消</button>
                                <button type="button" onclick="saveAllintitleConfigModal()" class="flex-1 px-6 py-4 rounded-2xl bg-slate-900 hover:bg-slate-800 text-white font-black text-xs uppercase tracking-widest transition-all shadow-lg shadow-slate-200">保存</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="fixed inset-0 z-[100] hidden" style="z-index: 1900;" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeImportModal()"></div>
        <div class="absolute inset-0" style="overflow-y:auto;">
            <div class="min-h-full flex items-start justify-center p-4 md:p-6">
                <div class="w-11/12 max-w-2xl">
                    <div class="bg-white rounded-[2rem] shadow-2xl border border-slate-100 overflow-hidden">
                        <div class="flex items-center justify-between gap-4 px-6 py-5 border-b border-slate-100">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-indigo-500 rounded-2xl flex items-center justify-center">
                                    <i class="fas fa-file-import text-white"></i>
                                </div>
                                <div class="leading-tight">
                                    <div class="text-sm font-black text-slate-900">批量导入关键词</div>
                                    <div class="text-[11px] font-bold text-slate-500">快速填充多行数据</div>
                                </div>
                            </div>
                            <button type="button" onclick="closeImportModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-black transition-all" aria-label="关闭">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="bg-indigo-50 rounded-2xl p-4 border border-indigo-100">
                                <div class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-2">预期数据格式 (每行一个关键词)</div>
                                <div class="text-xs font-bold text-indigo-900 leading-relaxed">
                                    关键词 [空格/逗号] 搜索量 [空格/逗号] 搜索意图 [空格/逗号] CPC [空格/逗号] KD%
                                </div>
                                <div class="text-[10px] font-bold text-indigo-500 mt-2 opacity-60">
                                    提示：支持使用逗号或空格分隔数据。
                                </div>
                            </div>
                            
                            <textarea id="importTextarea" rows="10" class="w-full bg-slate-50 border-2 border-slate-100 rounded-[1.5rem] px-4 py-4 font-bold text-slate-800 outline-none focus:border-indigo-500 transition-all text-sm leading-relaxed" placeholder="在此粘贴数据..."></textarea>
                            
                            <div id="importStatus" class="hidden text-xs font-bold px-4 py-2 rounded-lg"></div>
                        </div>
                        <div class="px-6 pb-8">
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button type="button" onclick="closeImportModal()" class="flex-1 px-6 py-4 rounded-2xl bg-slate-100 hover:bg-slate-200 text-slate-600 font-black text-xs uppercase tracking-widest transition-all">取消</button>
                                <button type="button" onclick="processImport()" class="flex-1 px-6 py-4 rounded-2xl bg-indigo-500 hover:bg-indigo-600 text-white font-black text-xs uppercase tracking-widest transition-all shadow-lg shadow-indigo-200">开始导入</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal -->
    <div id="deleteModal" class="fixed inset-0 z-[100] hidden" style="z-index: 1900;">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-sm p-6">
            <div class="bg-white rounded-[2rem] shadow-2xl p-8 text-center border border-slate-100 scale-95 transition-transform duration-300 ease-out" id="modalContent">
                <div class="w-20 h-20 bg-rose-50 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-trash-alt text-rose-500 text-3xl"></i>
                </div>
                <h4 class="text-xl font-black text-slate-900 mb-2">确认删除？</h4>
                <p class="text-slate-500 text-sm mb-8 leading-relaxed">您确定要删除这一行关键词调研数据吗？此操作不可撤销。</p>
                <div class="flex space-x-3">
                    <button onclick="closeModal()" class="flex-1 px-6 py-4 rounded-2xl bg-slate-100 hover:bg-slate-200 text-slate-600 font-black text-xs uppercase tracking-widest transition-all">
                        取消
                    </button>
                    <button id="confirmDeleteBtn" class="flex-1 px-6 py-4 rounded-2xl bg-rose-500 hover:bg-rose-600 text-white font-black text-xs uppercase tracking-widest transition-all shadow-lg shadow-rose-200">
                        确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="trendsModal" class="fixed inset-0 z-[110] hidden" style="z-index: 2000;" role="dialog" aria-modal="true">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeTrendsModal()"></div>
        <div class="absolute inset-0" style="overflow-y:auto;" id="trendsModalScroller">
            <div class="min-h-full flex items-start justify-center p-4 md:p-6">
                <div class="w-full max-w-6xl">
                    <div class="bg-white rounded-[2rem] shadow-2xl border border-slate-100 overflow-hidden" id="trendsModalContent">
                <div class="sticky top-0 bg-white flex flex-col md:flex-row md:items-center md:justify-between gap-4 px-6 py-5 border-b border-slate-100 z-10">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-sky-50 rounded-2xl flex items-center justify-center">
                            <i class="fas fa-chart-line text-sky-600"></i>
                        </div>
                        <div class="leading-tight">
                            <div class="text-sm font-black text-slate-900">Google 趋势</div>
                            <div class="text-[11px] font-bold text-slate-500" id="trendsKeywordLabel">-</div>
                        </div>
                    </div>
                    <div class="flex flex-wrap items-center gap-2">
                        <input id="trendsGeoInput" list="trendsGeoList" class="h-10 px-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-black text-[10px] tracking-widest transition-all outline-none" placeholder="选择地区（输入搜索）" autocomplete="off" />
                        <datalist id="trendsGeoList"></datalist>
                        <select id="trendsTimeSelect" class="h-10 px-3 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-black text-[10px] uppercase tracking-widest transition-all outline-none">
                            <option value="now 1-H">过去 1 小时</option>
                            <option value="now 4-H">过去 4 小时</option>
                            <option value="now 1-d">过去 1 天</option>
                            <option value="now 7-d">过去 7 天</option>
                            <option value="today 1-m">过去 30 天</option>
                            <option value="today 3-m">过去 90 天</option>
                            <option value="today 12-m">过去 12 个月</option>
                            <option value="today 5-y" selected>过去 5 年</option>
                            <option value="all">2004 至今</option>
                        </select>
                        <button type="button" onclick="trendsLastRenderKey='';renderTrends()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-black transition-all" title="刷新图表">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button type="button" onclick="closeTrendsModal()" class="w-10 h-10 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-black transition-all" aria-label="关闭">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div id="trendsLoading" class="text-slate-500 text-sm font-bold">加载中…</div>
                    <div id="trendsWidgetTimeseries" class="mt-4 rounded-2xl overflow-hidden border border-slate-100"></div>
                    <div id="trendsWidgetLeaderboard" class="mt-6 rounded-2xl overflow-hidden border border-slate-100"></div>
                    <div id="trendsWidgetSubregion" class="mt-6 rounded-2xl overflow-hidden border border-slate-100"></div>
                    <div id="trendsError" class="hidden mt-4 text-rose-600 text-sm font-bold"></div>
                </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white py-12 border-t border-gray-100">
        <div class="max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-center px-4 text-gray-500 text-sm">
            <div class="font-bold mb-4 md:mb-0">
                © 2024 SEO 快速排名指南 · 三九英雄出品 🚀
            </div>
            <div class="flex items-center space-x-4 bg-slate-50 px-4 py-2 rounded-full border border-slate-100">
                <img src="assets/qq.png" alt="QQ" class="w-5 h-5 object-contain shrink-0" loading="lazy" decoding="async">
                <span class="font-black text-slate-700">QQ 3760079636</span>
            </div>
        </div>
    </footer>

    <script>
        let kgrDebounceTimer;
        function debounceFetchKgrAllintitle() {
            const keywordInput = document.getElementById('kgrKeyword');
            const keyword = keywordInput.value.trim();
            
            // Clear previous timer
            if (kgrDebounceTimer) clearTimeout(kgrDebounceTimer);
            
            if (!keyword) return;

            // Set new timer
            kgrDebounceTimer = setTimeout(() => {
                fetchKgrAllintitleAuto(keyword);
            }, 1000); // 1 second delay to avoid excessive API calls
        }

        async function fetchKgrAllintitleAuto(keyword) {
            allintitleConfig = allintitleConfig || loadAllintitleConfig();
            
            // Only proceed if API is configured. 
            // We don't want to annoy user with modals if they just want to use the calculator manually
            if (!allintitleConfig.apiKey || !allintitleConfig.cx) {
                return;
            }

            const loadingIcon = document.getElementById('allintitleLoadingIcon');
            const allintitleInput = document.getElementById('allintitle');

            if(loadingIcon) loadingIcon.classList.remove('hidden');

            try {
                if (!allintitleConfig.enabled) {
                     allintitleConfig.enabled = true; // Auto enable if configured
                }

                const count = await fetchAllintitleCount(keyword);
                
                if (count !== null) {
                    allintitleInput.value = count;
                    allintitleInput.classList.remove('text-rose-500');
                    allintitleInput.title = '';
                    calculateKGR();
                }
            } catch (e) {
                console.error(e);
                const info = describeAllintitleError(e);
                allintitleInput.title = info.detail || (e.message || '获取失败');
                allintitleInput.classList.add('text-rose-500');
            } finally {
                if(loadingIcon) loadingIcon.classList.add('hidden');
            }
        }

        function calculateKGR() {
            const allintitle = parseFloat(document.getElementById('allintitle').value) || 0;
            const volume = parseFloat(document.getElementById('volume').value) || 0;
            const kgrResultEl = document.getElementById('kgrResult');
            
            if (volume === 0) {
                kgrResultEl.innerText = '-';
                return;
            }

            const kgr = allintitle / volume;
            const kgrText = kgr.toFixed(2);
            kgrResultEl.innerText = kgrText;

            // 动态调整字体大小以防止溢出
            let sizeClass = 'text-6xl md:text-8xl';
            if (kgrText.length > 8) {
                sizeClass = 'text-4xl md:text-6xl';
            } else if (kgrText.length > 5) {
                sizeClass = 'text-5xl md:text-7xl';
            }

            const statusEl = document.getElementById('kgrStatus');
            const adviceEl = document.getElementById('kgrAdvice');

            // 保持响应式类名一致
            const statusBaseClass = 'px-6 md:px-8 py-2 md:py-3 rounded-full font-black text-xs md:text-sm text-white shadow-lg mb-4 md:mb-6';

            if (kgr < 0.25) {
                statusEl.innerText = '潜力极佳 - 立即行动！';
                statusEl.className = `${statusBaseClass} bg-emerald-500 shadow-emerald-200`;
                adviceEl.innerText = '该关键词竞争非常小，只要内容质量过关，排名指日可待。';
                kgrResultEl.className = `${sizeClass} font-black text-emerald-600 tracking-tighter mb-4`;
            } else if (kgr <= 1.00) {
                statusEl.innerText = '潜力良好 - 建议尝试';
                statusEl.className = `${statusBaseClass} bg-amber-500 shadow-amber-200`;
                adviceEl.innerText = '有一定竞争，但对于优质内容仍有很大机会进入搜索前列。';
                kgrResultEl.className = `${sizeClass} font-black text-amber-600 tracking-tighter mb-4`;
            } else {
                statusEl.innerText = '竞争激烈 - 慎重选择';
                statusEl.className = `${statusBaseClass} bg-rose-500 shadow-rose-200`;
                adviceEl.innerText = '该词已被高度优化，建议寻找更细分的 KGR 词汇以避开竞争。';
                kgrResultEl.className = `${sizeClass} font-black text-rose-600 tracking-tighter mb-4`;
            }
        }

        // Add event listeners
        document.getElementById('allintitle').addEventListener('input', calculateKGR);
        document.getElementById('volume').addEventListener('input', calculateKGR);

        // Initial calculation
        calculateKGR();

        // Scroll Spy
        const sections = document.querySelectorAll('section[id], header[id]');
        const navItems = document.querySelectorAll('.nav-item');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (pageYOffset >= sectionTop - 200) {
                    current = section.getAttribute('id');
                }
            });

            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('href').slice(1) === current) {
                    item.classList.add('active');
                }
            });
        });

        // Table Functions
        function addTableRow(data = {}) {
            const tbody = document.querySelector('#kgrTable tbody');
            const newRow = document.createElement('tr');
            newRow.className = 'hover:bg-slate-50 transition-colors';
            
            const keyword = data.keyword || '新关键词';
            const volume = data.volume || '0';
            const intent = data.intent || '-';
            const cpc = data.cpc || '-';
            const kd = data.kd || '0%';
            const allintitle = data.allintitle || '0';

            newRow.innerHTML = `
                <td contenteditable="true" class="px-6 py-5 font-bold text-slate-700 outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">${keyword}</td>
                <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all table-volume">${volume}</td>
                <td contenteditable="true" class="px-6 py-5 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">${intent}</td>
                <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">${cpc}</td>
                <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all">${kd}</td>
                <td contenteditable="true" class="px-6 py-5 font-black text-slate-900 text-center outline-none focus:bg-orange-50 focus:text-orange-600 transition-all table-allintitle">${allintitle}</td>
                <td class="px-6 py-5 text-center table-kgr">
                    <span class="px-3 py-1 bg-slate-400 text-white rounded-lg text-[10px] font-black">0.00</span>
                </td>
                <td class="px-6 py-5 text-center">
                    <div class="flex items-center justify-center space-x-2">
                        <button onclick="openGoogleSearchForRow(this)" class="text-indigo-400 hover:text-indigo-600 transition-colors" title="Google 搜索验证">
                            <i class="fab fa-google"></i>
                        </button>
                        <button onclick="openGoogleTrendsForRow(this)" class="text-sky-500 hover:text-sky-700 transition-colors" title="Google 趋势">
                            <i class="fas fa-chart-line"></i>
                        </button>
                        <button onclick="confirmDelete(this)" class="text-rose-400 hover:text-rose-600 transition-colors" title="删除">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </td>
            `;
            tbody.appendChild(newRow);
            bindTableEvents();
            calculateTableKGR(newRow);

            // If it's a new keyword and Allintitle API is enabled, trigger fetch
            allintitleConfig = allintitleConfig || loadAllintitleConfig();
            if (data.keyword && allintitleConfig.enabled) {
                scheduleRowAllintitleUpdate(newRow, data.keyword);
            }
        }

        let lastFocusedEl = null;
        const trendsRegionCodes = ['AD','AE','AF','AG','AI','AL','AM','AO','AQ','AR','AS','AT','AU','AW','AX','AZ','BA','BB','BD','BE','BF','BG','BH','BI','BJ','BL','BM','BN','BO','BQ','BR','BS','BT','BV','BW','BY','BZ','CA','CC','CD','CF','CG','CH','CI','CK','CL','CM','CN','CO','CR','CU','CV','CW','CX','CY','CZ','DE','DJ','DK','DM','DO','DZ','EC','EE','EG','EH','ER','ES','ET','FI','FJ','FK','FM','FO','FR','GA','GB','GD','GE','GF','GG','GH','GI','GL','GM','GN','GP','GQ','GR','GS','GT','GU','GW','GY','HK','HM','HN','HR','HT','HU','ID','IE','IL','IM','IN','IO','IQ','IR','IS','IT','JE','JM','JO','JP','KE','KG','KH','KI','KM','KN','KP','KR','KW','KY','KZ','LA','LB','LC','LI','LK','LR','LS','LT','LU','LV','LY','MA','MC','MD','ME','MF','MG','MH','MK','ML','MM','MN','MO','MP','MQ','MR','MS','MT','MU','MV','MW','MX','MY','MZ','NA','NC','NE','NF','NG','NI','NL','NO','NP','NR','NU','NZ','OM','PA','PE','PF','PG','PH','PK','PL','PM','PN','PR','PS','PT','PW','PY','QA','RE','RO','RS','RU','RW','SA','SB','SC','SD','SE','SG','SH','SI','SJ','SK','SL','SM','SN','SO','SR','SS','ST','SV','SX','SY','SZ','TC','TD','TF','TG','TH','TJ','TK','TL','TM','TN','TO','TR','TT','TV','TW','TZ','UA','UG','UM','US','UY','UZ','VA','VC','VE','VG','VI','VN','VU','WF','WS','YE','YT','ZA','ZM','ZW','XK'];
        let trendsGeoLabelByCode = {};
        let trendsGeoCodeByLabel = {};
        let trendsGeoDatalistBuilt = false;
        let trendsState = { geo: '', time: 'today 5-y' };
        let currentTrendsKeyword = 'seo';
        let trendsControlsInited = false;
        let trendsRenderDebounceTimer = null;
        let trendsSubregionObserver = null;
        let trendsSubregionMountTimer = null;

        function scheduleRenderTrends() {
            if (trendsRenderDebounceTimer) window.clearTimeout(trendsRenderDebounceTimer);
            trendsRenderDebounceTimer = window.setTimeout(() => {
                trendsRenderDebounceTimer = null;
                renderTrends();
            }, 250);
        }

        function getRowKeyword(btn) {
            const row = btn ? btn.closest('tr') : null;
            const keywordCell = row ? row.querySelector('td[contenteditable="true"]') : null;
            const keyword = keywordCell ? keywordCell.innerText.trim() : '';
            return keyword || 'seo';
        }

        function openGoogleSearchForRow(btn) {
            const keyword = getRowKeyword(btn);
            if (!keyword) return;
            const q = buildAllintitleQuery(keyword);
            window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`, '_blank');
        }

        function getActiveKeyword() {
            const activeEl = document.activeElement;
            const activeCell = activeEl && activeEl.closest ? activeEl.closest('#kgrTable td[contenteditable="true"]') : null;
            if (activeCell) {
                const row = activeCell.closest('tr');
                const keywordCell = row ? row.querySelector('td[contenteditable="true"]') : null;
                const keyword = keywordCell ? keywordCell.innerText.trim() : '';
                return keyword || 'seo';
            }
            const firstKeywordCell = document.querySelector('#kgrTable tbody tr td[contenteditable="true"]');
            const keyword = firstKeywordCell ? firstKeywordCell.innerText.trim() : '';
            return keyword || 'seo';
        }

        function openTrendsModalFromActive() {
            openTrendsModal(getActiveKeyword());
        }

        function openGoogleTrendsForRow(btn) {
            openTrendsModal(getRowKeyword(btn));
        }

        function scrollTrendsTo(id) {
            const scroller = document.getElementById('trendsModalScroller');
            const target = document.getElementById(id);
            if (!scroller || !target) return;
            const scrollerRect = scroller.getBoundingClientRect();
            const targetRect = target.getBoundingClientRect();
            const top = Math.max(0, targetRect.top - scrollerRect.top + scroller.scrollTop - 12);
            scroller.scrollTo({ top, behavior: 'smooth' });
        }

        function warmupTrendsConnections() {
            const targets = ['https://ssl.gstatic.com', 'https://trends.google.com'];
            targets.forEach(href => {
                if (document.querySelector(`link[rel="preconnect"][href="${href}"]`)) return;
                const link = document.createElement('link');
                link.rel = 'preconnect';
                link.href = href;
                document.head.appendChild(link);
            });
        }

        let trendsLibraryPromise = null;
        let trendsLastRenderKey = '';
        function loadTrendsLibrary() {
            if (trendsLibraryPromise) return trendsLibraryPromise;
            trendsLibraryPromise = new Promise((resolve, reject) => {
                if (window.trends && window.trends.embed) return resolve();
                warmupTrendsConnections();
                const script = document.createElement('script');
                script.src = 'https://ssl.gstatic.com/trends_nrtr/4284_RC01/embed_loader.js';
                script.onload = () => {
                    // Poll for window.trends to be ready
                    let checks = 0;
                    const timer = setInterval(() => {
                        if (window.trends && window.trends.embed) {
                            clearInterval(timer);
                            resolve();
                        } else {
                            checks++;
                            if (checks > 50) { // 5 seconds timeout
                                clearInterval(timer);
                                trendsLibraryPromise = null;
                                reject(new Error('Google Trends library loaded but trends object not initialized'));
                            }
                        }
                    }, 100);
                };
                script.onerror = () => {
                    trendsLibraryPromise = null;
                    reject(new Error('Failed to load Google Trends library'));
                };
                document.head.appendChild(script);
            });
            return trendsLibraryPromise;
        }

        function getTrendsRenderKey() {
            return `${currentTrendsKeyword}__${trendsState.geo}__${trendsState.time}`;
        }

        function buildTrendsExploreQuery() {
            const geo = trendsState.geo || '';
            return `date=${trendsState.time}&geo=${geo}&q=${encodeURIComponent(currentTrendsKeyword)}&hl=zh-CN`;
        }

        function syncTrendsContainerHeightToIframe(container, fallbackPx, fixedHeightPx) {
            if (!container) return;
            const fallback = Number.isFinite(fallbackPx) ? fallbackPx : 0;
            const fixed = Number.isFinite(fixedHeightPx) ? fixedHeightPx : 0;
            if (fallback > 0) container.style.minHeight = `${Math.ceil(fallback)}px`;

            let tries = 0;
            let resizeTimer = null;
            let iframeObserver = null;
            let containerObserver = null;
            let boundIframe = null;

            const readIframeHeight = (iframe) => {
                if (!iframe) return 0;
                const fromStyle = parseFloat(iframe.style.height || '');
                if (Number.isFinite(fromStyle) && fromStyle > 0) return fromStyle;
                const computed = window.getComputedStyle ? window.getComputedStyle(iframe).height : '';
                const fromComputed = parseFloat(computed || '');
                if (Number.isFinite(fromComputed) && fromComputed > 0) return fromComputed;
                return 0;
            };

            const update = () => {
                const iframe = container.querySelector('iframe');
                if (!iframe) return;
                if (fixed > 0) {
                    if (iframe.style.height !== `${fixed}px`) iframe.style.height = `${fixed}px`;
                    if (container.style.minHeight !== `${fixed}px`) container.style.minHeight = `${fixed}px`;
                    return;
                }

                const h = readIframeHeight(iframe);
                if (h > 0) container.style.minHeight = `${Math.ceil(h)}px`;
            };

            const tick = () => {
                const iframe = container.querySelector('iframe');
                if (iframe) {
                    iframe.style.display = 'block';
                    if (boundIframe !== iframe) {
                        boundIframe = iframe;
                        if (iframeObserver) iframeObserver.disconnect();
                        iframeObserver = null;
                        if ('MutationObserver' in window) {
                            iframeObserver = new MutationObserver(() => update());
                            iframeObserver.observe(iframe, { attributes: true, attributeFilter: ['style'] });
                        }
                    }
                    update();

                    if (!containerObserver && 'MutationObserver' in window) {
                        containerObserver = new MutationObserver(() => update());
                        containerObserver.observe(container, { childList: true, subtree: true });
                    }

                    window.addEventListener('resize', () => {
                        if (resizeTimer) window.clearTimeout(resizeTimer);
                        resizeTimer = window.setTimeout(() => update(), 120);
                    }, { passive: true });
                    return;
                }
                tries += 1;
                if (tries < 300) window.requestAnimationFrame(tick);
            };
            window.requestAnimationFrame(tick);
        }

        function renderTrendsTimeseries(trendsApi, container) {
            trendsApi.embed.renderExploreWidgetTo(container, "TIMESERIES", {
                comparisonItem: [{ keyword: currentTrendsKeyword, geo: trendsState.geo, time: trendsState.time }],
                category: 0,
                property: ''
            }, {
                exploreQuery: buildTrendsExploreQuery(),
                guestPath: "https://trends.google.com:443/trends/embed/"
            });
        }

        function renderTrendsSubregion(trendsApi, container) {
            trendsApi.embed.renderExploreWidgetTo(container, "GEO_MAP", {
                comparisonItem: [{ keyword: currentTrendsKeyword, geo: trendsState.geo, time: trendsState.time }],
                category: 0,
                property: ''
            }, {
                exploreQuery: buildTrendsExploreQuery(),
                guestPath: "https://trends.google.com:443/trends/embed/"
            });
        }

        function renderTrendsLeaderboard(trendsApi, container) {
            trendsApi.embed.renderExploreWidgetTo(container, "RELATED_QUERIES", {
                comparisonItem: [{ keyword: currentTrendsKeyword, geo: trendsState.geo, time: trendsState.time }],
                category: 0,
                property: ''
            }, {
                exploreQuery: buildTrendsExploreQuery(),
                guestPath: "https://trends.google.com:443/trends/embed/"
            });
        }

        function setupTrendsSubregionLazyRender(trendsApi) {
            const widgetSubregion = document.getElementById('trendsWidgetSubregion');
            if (!widgetSubregion) return;
            if (widgetSubregion.dataset.trendsRendered === '1') return;

            const isSmallScreen = window.matchMedia && window.matchMedia('(max-width: 640px)').matches;
            const fallbackHeight = isSmallScreen ? 520 : 560;

            const renderNow = () => {
                if (widgetSubregion.dataset.trendsRendered === '1') return;
                widgetSubregion.dataset.trendsRendered = '1';
                const fixedHeight = 415;
                renderTrendsSubregion(trendsApi, widgetSubregion);
                syncTrendsContainerHeightToIframe(widgetSubregion, fallbackHeight, fixedHeight);
            };

            if (!('IntersectionObserver' in window)) {
                window.setTimeout(renderNow, 50);
                return;
            }

            if (trendsSubregionObserver) trendsSubregionObserver.disconnect();
            trendsSubregionObserver = new IntersectionObserver((entries) => {
                const hit = entries && entries.some((e) => e.isIntersecting);
                if (!hit) return;
                if (trendsSubregionObserver) trendsSubregionObserver.disconnect();
                trendsSubregionObserver = null;
                renderNow();
            }, { threshold: 0.05 });

            trendsSubregionObserver.observe(widgetSubregion);
        }

        function initTrendsControls() {
            if (trendsControlsInited) return;
            trendsControlsInited = true;

            const geoInput = document.getElementById('trendsGeoInput');
            const timeSelect = document.getElementById('trendsTimeSelect');

            buildTrendsGeoDatalist();

            if (geoInput) {
                const onGeoChange = () => {
                    const next = parseTrendsGeoInput(geoInput.value);
                    trendsState.geo = next;
                    geoInput.value = formatTrendsGeoLabel(next);
                    scheduleRenderTrends();
                };
                geoInput.addEventListener('change', onGeoChange);
                geoInput.addEventListener('blur', onGeoChange);
            }

            if (timeSelect) {
                timeSelect.addEventListener('change', () => {
                    trendsState.time = timeSelect.value;
                    scheduleRenderTrends();
                });
            }
        }

        function buildTrendsGeoDatalist() {
            if (trendsGeoDatalistBuilt) return;
            trendsGeoDatalistBuilt = true;

            const datalist = document.getElementById('trendsGeoList');
            if (!datalist) return;

            const displayNames = (typeof Intl !== 'undefined' && Intl.DisplayNames) ? new Intl.DisplayNames(['zh-CN'], { type: 'region' }) : null;

            const items = [];
            const globalLabel = '全球';
            trendsGeoLabelByCode[''] = globalLabel;
            trendsGeoCodeByLabel[globalLabel] = '';
            items.push({ code: '', label: globalLabel });

            trendsRegionCodes.forEach((code) => {
                const name = displayNames ? (displayNames.of(code) || code) : code;
                const label = `${name} (${code})`;
                trendsGeoLabelByCode[code] = label;
                trendsGeoCodeByLabel[label] = code;
                if (!trendsGeoCodeByLabel[name]) trendsGeoCodeByLabel[name] = code;
                items.push({ code, label, name });
            });

            items.sort((a, b) => {
                if (a.code === '') return -1;
                if (b.code === '') return 1;
                return (a.name || a.label).localeCompare((b.name || b.label), 'zh-Hans-CN');
            });

            const frag = document.createDocumentFragment();
            items.forEach((item) => {
                const option = document.createElement('option');
                option.value = item.code === '' ? item.label : item.label;
                frag.appendChild(option);
            });
            datalist.appendChild(frag);
        }

        function parseTrendsGeoInput(value) {
            const v = (value || '').trim();
            if (!v || v === '全球') return '';

            const parenMatch = v.match(/\(([A-Za-z]{2})\)\s*$/);
            if (parenMatch) return parenMatch[1].toUpperCase();
            if (/^[A-Za-z]{2}$/.test(v)) return v.toUpperCase();
            if (trendsGeoCodeByLabel[v]) return trendsGeoCodeByLabel[v];
            return trendsState.geo;
        }

        function formatTrendsGeoLabel(code) {
            if (!code) return '全球';
            return trendsGeoLabelByCode[code] || code;
        }

        async function renderTrends() {
            const keywordLabel = document.getElementById('trendsKeywordLabel');
            const loading = document.getElementById('trendsLoading');
            const widgetTimeseries = document.getElementById('trendsWidgetTimeseries');
            const widgetLeaderboard = document.getElementById('trendsWidgetLeaderboard');
            const widgetSubregion = document.getElementById('trendsWidgetSubregion');
            const error = document.getElementById('trendsError');
            const geoInput = document.getElementById('trendsGeoInput');
            const timeSelect = document.getElementById('trendsTimeSelect');

            const isSmallScreen = window.matchMedia && window.matchMedia('(max-width: 640px)').matches;
            const subregionHeight = isSmallScreen ? 520 : 560;
            const fixedHeightTimeseries = 420;
            const fixedHeightLeaderboard = 375;
            const fixedHeightSubregion = 415;

            if (!widgetTimeseries || !widgetLeaderboard || !widgetSubregion || !loading || !error || !keywordLabel) return;

            keywordLabel.textContent = currentTrendsKeyword;
            if (geoInput) geoInput.value = formatTrendsGeoLabel(trendsState.geo);
            if (timeSelect) timeSelect.value = trendsState.time;

            error.classList.add('hidden');
            error.textContent = '';
            loading.classList.remove('hidden');

            const nextKey = getTrendsRenderKey();

            if (trendsLastRenderKey === nextKey && widgetTimeseries.childNodes.length > 0) {
                loading.classList.add('hidden');
                error.classList.add('hidden');
                error.textContent = '';
                return;
            }

            trendsLastRenderKey = nextKey;

            widgetTimeseries.innerHTML = '';
            widgetLeaderboard.innerHTML = '';
            widgetSubregion.innerHTML = '';
            widgetSubregion.dataset.trendsRendered = '0';
            widgetTimeseries.style.minHeight = `${fixedHeightTimeseries}px`;
            widgetLeaderboard.style.minHeight = `${fixedHeightLeaderboard}px`;
            widgetSubregion.style.minHeight = `${fixedHeightSubregion}px`;

            try {
                await loadTrendsLibrary();

                await new Promise(resolve => setTimeout(resolve, 50));

                const trendsApi = window.trends || (typeof trends !== 'undefined' ? trends : null);
                
                if (!trendsApi || !trendsApi.embed) {
                    trendsLibraryPromise = null;
                    throw new Error('Google Trends object not found after loading');
                }

                loading.classList.add('hidden');

                renderTrendsTimeseries(trendsApi, widgetTimeseries);
                syncTrendsContainerHeightToIframe(widgetTimeseries, 420, fixedHeightTimeseries);
                renderTrendsLeaderboard(trendsApi, widgetLeaderboard);
                syncTrendsContainerHeightToIframe(widgetLeaderboard, 380, fixedHeightLeaderboard);
                setupTrendsSubregionLazyRender(trendsApi);

            } catch (err) {
                console.error(err);
                loading.classList.add('hidden');
                error.classList.remove('hidden');
                error.textContent = `无法加载 Google Trends 组件: ${err.message || '未知错误'} (可能是 Google 接口限流 429 或网络连接问题，请检查是否已开启科学上网并稍后再试)`;
            }
        }

        async function openTrendsModal(keyword) {
            const modal = document.getElementById('trendsModal');
            const scroller = document.getElementById('trendsModalScroller');
            const keywordLabel = document.getElementById('trendsKeywordLabel');
            const loading = document.getElementById('trendsLoading');
            const widgetTimeseries = document.getElementById('trendsWidgetTimeseries');
            const widgetLeaderboard = document.getElementById('trendsWidgetLeaderboard');
            const widgetSubregion = document.getElementById('trendsWidgetSubregion');
            const error = document.getElementById('trendsError');
            const geoInput = document.getElementById('trendsGeoInput');
            const timeSelect = document.getElementById('trendsTimeSelect');

            lastFocusedEl = document.activeElement;

            initTrendsControls();

            const safeKeyword = (keyword || 'seo').trim() || 'seo';
            currentTrendsKeyword = safeKeyword;
            keywordLabel.textContent = safeKeyword;
            if (geoInput) geoInput.value = formatTrendsGeoLabel(trendsState.geo);
            if (timeSelect) timeSelect.value = trendsState.time;

            error.classList.add('hidden');
            error.textContent = '';
            loading.classList.remove('hidden');
            if (widgetTimeseries) widgetTimeseries.innerHTML = '';
            if (widgetLeaderboard) widgetLeaderboard.innerHTML = '';
            if (widgetSubregion) widgetSubregion.innerHTML = '';

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            if (scroller) scroller.scrollTop = 0;

            const nextKey = getTrendsRenderKey();
            const hasRendered = widgetTimeseries && widgetTimeseries.childNodes.length > 0 && trendsLastRenderKey === nextKey;
            if (!hasRendered) renderTrends();
        }

        function closeTrendsModal() {
            const modal = document.getElementById('trendsModal');
            const widgetTimeseries = document.getElementById('trendsWidgetTimeseries');
            const widgetSubregion = document.getElementById('trendsWidgetSubregion');
            if (!modal || modal.classList.contains('hidden')) return;
            modal.classList.add('hidden');
            document.body.style.overflow = '';
            if (trendsSubregionObserver) {
                trendsSubregionObserver.disconnect();
                trendsSubregionObserver = null;
            }
            if (lastFocusedEl && lastFocusedEl.focus) lastFocusedEl.focus();
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeTrendsModal();
        });

        // Modal Logic
        let rowToDelete = null;
        function confirmDelete(btn) {
            rowToDelete = btn.closest('tr');
            const modal = document.getElementById('deleteModal');
            const content = document.getElementById('modalContent');
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('deleteModal');
            const content = document.getElementById('modalContent');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
                rowToDelete = null;
            }, 200);
        }

        document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
            if (rowToDelete) {
                rowToDelete.remove();
                closeModal();
            }
        });

        let xlsxLibraryPromise = null;
        let isExportingXlsx = false;
        function ensureXlsxLoaded() {
            if (window.XLSX) return Promise.resolve();
            if (xlsxLibraryPromise) return xlsxLibraryPromise;
            xlsxLibraryPromise = new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.bootcdn.net/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
                script.async = true;
                script.onload = () => {
                    if (window.XLSX) resolve();
                    else reject(new Error('XLSX loaded but window.XLSX is missing'));
                };
                script.onerror = () => reject(new Error('Failed to load XLSX library'));
                document.head.appendChild(script);
            }).catch(err => {
                xlsxLibraryPromise = null;
                throw err;
            });
            return xlsxLibraryPromise;
        }

        async function exportToXLSX() {
            if (isExportingXlsx) return;
            isExportingXlsx = true;
            try {
                await ensureXlsxLoaded();
            } catch {
                showCenteredAlert('导出失败', 'XLSX 依赖加载失败，请检查网络后重试。');
                isExportingXlsx = false;
                return;
            }

            try {
                const table = document.getElementById('kgrTable');
                const rows = Array.from(table.querySelectorAll('tr'));
                
                const data = rows.map(row => {
                    const cells = Array.from(row.querySelectorAll('th, td'));
                    return cells.slice(0, -1).map(cell => {
                        if (cell.classList.contains('table-kgr')) {
                            return cell.querySelector('span') ? cell.querySelector('span').innerText : cell.innerText;
                        }
                        return cell.innerText;
                    });
                });

                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "KGR 关键词研究");

                const date = new Date().toISOString().split('T')[0];
                const filename = `KGR_Keywords_${date}.xlsx`;

                XLSX.writeFile(wb, filename);
            } finally {
                isExportingXlsx = false;
            }
        }

        function calculateTableKGR(row) {
            const volumeText = row.querySelector('.table-volume').innerText.replace(/,/g, '');
            const allintitleText = row.querySelector('.table-allintitle').innerText.replace(/,/g, '');
            
            const volume = parseFloat(volumeText) || 0;
            const allintitle = parseFloat(allintitleText) || 0;
            const kgrCell = row.querySelector('.table-kgr');
            
            if (volume === 0) {
                kgrCell.innerHTML = `<span class="px-3 py-1 bg-slate-400 text-white rounded-lg text-[10px] font-black">0.00</span>`;
                return;
            }

            const kgr = allintitle / volume;
            let bgColor = 'bg-rose-500';
            if (kgr < 0.25) bgColor = 'bg-emerald-500';
            else if (kgr <= 1.00) bgColor = 'bg-amber-500';

            kgrCell.innerHTML = `<span class="px-3 py-1 ${bgColor} text-white rounded-lg text-[10px] font-black">${kgr.toFixed(2)}</span>`;
        }

        const ALLINTITLE_CONFIG_STORAGE_KEY = 'kgr_allintitle_config_v1';
        let allintitleConfig = null;
        const allintitleRowTimers = new WeakMap();
        const allintitleCache = new Map();
        const allintitleInFlight = new Map();
        let allintitleQueue = Promise.resolve();

        function loadAllintitleConfig() {
            try {
                const raw = window.localStorage.getItem(ALLINTITLE_CONFIG_STORAGE_KEY);
                if (!raw) return { enabled: false, apiKey: '', cx: '' };
                const parsed = JSON.parse(raw);
                return {
                    enabled: !!parsed.enabled,
                    apiKey: typeof parsed.apiKey === 'string' ? parsed.apiKey : '',
                    cx: typeof parsed.cx === 'string' ? parsed.cx : ''
                };
            } catch {
                return { enabled: false, apiKey: '', cx: '' };
            }
        }

        function saveAllintitleConfig(next) {
            allintitleConfig = { enabled: !!next.enabled, apiKey: next.apiKey || '', cx: next.cx || '' };
            try {
                window.localStorage.setItem(ALLINTITLE_CONFIG_STORAGE_KEY, JSON.stringify(allintitleConfig));
            } catch {
            }
        }

        function openAllintitleConfigModal() {
            const modal = document.getElementById('allintitleConfigModal');
            const enabledInput = document.getElementById('allintitleEnabledInput');
            const apiKeyInput = document.getElementById('allintitleApiKeyInput');
            const cxInput = document.getElementById('allintitleCxInput');
            const hint = document.getElementById('allintitleConfigHint');
            if (!modal || !enabledInput || !apiKeyInput || !cxInput || !hint) return;

            allintitleConfig = allintitleConfig || loadAllintitleConfig();
            enabledInput.checked = !!allintitleConfig.enabled;
            apiKeyInput.value = allintitleConfig.apiKey || '';
            cxInput.value = allintitleConfig.cx || '';
            hint.classList.add('hidden');
            hint.textContent = '';

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            window.setTimeout(() => apiKeyInput.focus(), 30);
        }

        function closeAllintitleConfigModal() {
            const modal = document.getElementById('allintitleConfigModal');
            if (!modal || modal.classList.contains('hidden')) return;
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Import Modal
        function openImportModal() {
            const modal = document.getElementById('importModal');
            if (!modal) return;
            document.getElementById('importTextarea').value = '';
            document.getElementById('importStatus').classList.add('hidden');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeImportModal() {
            const modal = document.getElementById('importModal');
            if (!modal || modal.classList.contains('hidden')) return;
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        function processImport() {
            const textarea = document.getElementById('importTextarea');
            const status = document.getElementById('importStatus');
            const text = textarea.value.trim();
            
            if (!text) {
                status.textContent = '请输入要导入的数据';
                status.className = 'text-xs font-bold px-4 py-2 rounded-lg bg-rose-50 text-rose-600';
                status.classList.remove('hidden');
                return;
            }

            const lines = text.split('\n');
            let successCount = 0;

            lines.forEach(line => {
                const rowText = line.trim();
                if (!rowText) return;

                // Split by comma or multiple spaces
                let parts = [];
                if (rowText.includes(',')) {
                    parts = rowText.split(',');
                } else {
                    parts = rowText.split(/\s{2,}/); // Two or more spaces
                    if (parts.length <= 1) parts = rowText.split(' '); // Fallback to single space
                }

                const data = {
                    keyword: parts[0]?.trim() || '新关键词',
                    volume: parts[1]?.trim() || '0',
                    intent: parts[2]?.trim() || '-',
                    cpc: parts[3]?.trim() || '-',
                    kd: parts[4]?.trim() || '0%'
                };

                addTableRow(data);
                successCount++;
            });

            status.textContent = `成功导入 ${successCount} 条数据！`;
            status.className = 'text-xs font-bold px-4 py-2 rounded-lg bg-emerald-50 text-emerald-600';
            status.classList.remove('hidden');

            setTimeout(() => {
                closeImportModal();
            }, 1000);
        }

        function normalizeAllintitleApiKeyInput(raw) {
            let value = (raw || '').trim();
            if (!value) return '';

            value = value.replace(/^key\s*[:=]\s*/i, '').replace(/["'`\s]+/g, '');

            try {
                if (/^https?:\/\//i.test(value)) {
                    const u = new URL(value);
                    const k = u.searchParams.get('key');
                    if (k) return k.trim();
                }
            } catch {
            }

            const m = value.match(/[?&]key=([^&]+)/i);
            if (m && m[1]) {
                try {
                    return decodeURIComponent(m[1]).trim();
                } catch {
                    return m[1].trim();
                }
            }

            return value;
        }

        function normalizeAllintitleCxInput(raw) {
            let value = (raw || '').trim();
            if (!value) return '';

            value = value.replace(/^cx\s*[:=]\s*/i, '').replace(/["'`\s;]+/g, '');

            try {
                if (/^https?:\/\//i.test(value)) {
                    const u = new URL(value);
                    const cx = u.searchParams.get('cx');
                    if (cx) return cx.trim();
                }
            } catch {
            }

            const m = value.match(/[?&]cx=([^&]+)/i);
            if (m && m[1]) {
                try {
                    return decodeURIComponent(m[1]).trim();
                } catch {
                    return m[1].trim();
                }
            }

            return value;
        }

        function describeAllintitleError(e) {
            const msg = (e && e.message) ? String(e.message) : '未知错误';
            const lower = msg.toLowerCase();
            const status = e && typeof e.httpStatus === 'number' ? e.httpStatus : null;
            const isFile = (window.location && window.location.protocol === 'file:');

            if (lower.includes('quota') || lower.includes('daily limit') || status === 429) {
                return {
                    code: 'Quota Limit',
                    title: '配额已耗尽',
                    detail: 'Google Custom Search API 免费版通常每天 100 次查询，今日配额已用完。\n\n解决：更换 API Key 或等待次日重置。\n\n(错误信息: ' + msg + ')'
                };
            }

            if (lower.includes('requested entity was not found')) {
                return {
                    code: 'Bad cx',
                    title: 'cx 无效或找不到搜索引擎',
                    detail: '当前 cx 看起来不是有效的 Programmable Search Engine ID，或该搜索引擎不存在/未公开。\n\n解决：\n1) 进入 Programmable Search Engine 控制台复制 “Search engine ID”。\n2) 仅粘贴形如 0123...:abcd... 的 ID，不要粘贴整段脚本/URL。\n3) 确认已开启 “Search the entire web”。\n\n(错误信息: ' + msg + ')'
                };
            }

            if (lower.includes('api key not valid') || lower.includes('invalid api key') || lower.includes('keyinvalid')) {
                return {
                    code: 'Bad key',
                    title: 'API Key 无效',
                    detail: 'API Key 不正确或已失效。\n\n解决：\n1) 确认已在 Google Cloud 创建 API Key。\n2) 确认已启用 “Custom Search API”。\n\n(错误信息: ' + msg + ')'
                };
            }

            if (lower.includes('referer') || lower.includes('referrer') || lower.includes('origin') || lower.includes('referer <empty>')) {
                return {
                    code: 'Ref Err',
                    title: 'Key 限制导致请求被拦截',
                    detail: (isFile
                        ? '你正在用 file:// 方式打开页面，浏览器的 Origin/Referer 可能是空值，若 API Key 开启了 HTTP referrer 限制会被拦截。\n\n解决：\n1) 将页面通过 http://localhost 打开（用任意本地静态服务器）。\n2) 或在 Google Cloud 控制台放开/正确配置 API Key 的网站来源限制。\n\n(错误信息: ' + msg + ')'
                        : 'API Key 开启了来源(Referrer/Origin)限制，当前页面域名不在允许列表内。\n\n解决：在 Google Cloud 控制台把当前域名加入允许列表，或放开限制。\n\n(错误信息: ' + msg + ')')
                };
            }

            if (lower.includes('has not been used') || lower.includes('is disabled') || lower.includes('access not configured') || (status === 403 && lower.includes('custom search api'))) {
                return {
                    code: 'API Off',
                    title: 'Custom Search API 未启用',
                    detail: 'Google Cloud 项目里未启用 Custom Search API，或权限未配置。\n\n解决：在 Google Cloud 控制台启用 “Custom Search API”，稍等几分钟再试。\n\n(错误信息: ' + msg + ')'
                };
            }

            if (lower.includes('billing')) {
                return {
                    code: 'Billing',
                    title: '计费/账单限制',
                    detail: '该项目可能需要启用计费或受账单策略影响。\n\n(错误信息: ' + msg + ')'
                };
            }

            if (lower.includes('failed to fetch') || lower.includes('networkerror') || lower.includes('load failed')) {
                return {
                    code: 'Net Err',
                    title: '网络请求失败',
                    detail: (isFile
                        ? '请求失败（可能是网络、代理、或 file:// 场景下的限制）。\n\n建议：用 http://localhost 打开页面后重试。\n\n(错误信息: ' + msg + ')'
                        : '请求失败（可能是网络、代理、或浏览器阻止）。\n\n(错误信息: ' + msg + ')')
                };
            }

            if (typeof status === 'number') {
                return {
                    code: `Err ${status}`,
                    title: '获取 Allintitle 失败',
                    detail: '请求返回错误状态码：' + status + '\n\n(错误信息: ' + msg + ')'
                };
            }

            return {
                code: 'Error',
                title: '获取 Allintitle 失败',
                detail: msg
            };
        }

        async function saveAllintitleConfigModal() {
            const enabledInput = document.getElementById('allintitleEnabledInput');
            const apiKeyInput = document.getElementById('allintitleApiKeyInput');
            const cxInput = document.getElementById('allintitleCxInput');
            const hint = document.getElementById('allintitleConfigHint');
            if (!enabledInput || !apiKeyInput || !cxInput || !hint) return;

            const enabled = enabledInput.checked;
            const apiKey = normalizeAllintitleApiKeyInput(apiKeyInput.value);
            const cx = normalizeAllintitleCxInput(cxInput.value);

            apiKeyInput.value = apiKey;
            cxInput.value = cx;

            if (enabled && (!apiKey || !cx)) {
                hint.textContent = '启用自动获取需要同时填写 API Key 和 cx。';
                hint.classList.remove('hidden');
                return;
            }

            saveAllintitleConfig({ enabled, apiKey, cx });

            if (enabled) {
                hint.textContent = '正在验证配置...';
                hint.classList.remove('hidden');
                try {
                    await fetchAllintitleCount('test');
                } catch (e) {
                    const info = describeAllintitleError(e);
                    hint.textContent = `${info.code}: ${info.detail}`;
                    return;
                }
            }

            closeAllintitleConfigModal();

            if (enabled) {
                document.querySelectorAll('#kgrTable tbody tr').forEach((row) => {
                    const keywordCell = row.querySelector('td[contenteditable="true"]');
                    const keyword = keywordCell ? keywordCell.innerText.trim() : '';
                    if (keyword) scheduleRowAllintitleUpdate(row, keyword);
                });
            }
        }

        function buildAllintitleQuery(keyword) {
            // 1. 去除首尾空格并强制移除所有双引号，确保始终使用宽泛匹配
            const trimmed = (keyword || '').trim().replace(/"/g, '');
            
            if (!trimmed) return '';
            
            // 2. 针对普通带空格的词，直接拼接
            // 注意：不要在 ${trimmed} 外面加引号，这样 Google 才会做宽泛匹配
            return `allintitle:${trimmed}`;
        }

        function setAllintitleCell(row, text) {
            const cell = row.querySelector('.table-allintitle');
            if (!cell) return;
            
            // 如果是数字，添加验证链接
            if (!isNaN(text) && text !== '-') {
                const keyword = row.querySelector('td[contenteditable="true"]')?.innerText?.trim() || '';
                const q = buildAllintitleQuery(keyword);
                // 构造 Google 验证链接：使用 filter=0 显示省略结果，hl=en 避免本地化干扰
                const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(q)}&filter=0&hl=en&gl=us`;
                
                cell.innerHTML = `
                    <div class="flex items-center justify-center gap-1 group relative">
                        <span class="font-bold text-slate-700">${text}</span>
                        <a href="${googleUrl}" target="_blank" 
                           class="opacity-30 group-hover:opacity-100 transition-opacity text-slate-400 hover:text-indigo-600" 
                           title="点击跳转 Google 验证 (请务必翻到最后一页查看真实数量)">
                            <i class="fas fa-external-link-alt text-[10px]"></i>
                        </a>
                    </div>
                `;
            } else {
                cell.innerText = String(text);
            }

            // Clear error states
            cell.classList.remove('text-rose-500', 'cursor-pointer', 'underline', 'decoration-dotted');
            cell.title = '';
            cell.onclick = null;
            
            calculateTableKGR(row);
        }

        function setAllintitleLoading(row) {
            const cell = row.querySelector('.table-allintitle');
            if (!cell) return;
            cell.innerText = '…';
            // Clear error states
            cell.classList.remove('text-rose-500', 'cursor-pointer', 'underline', 'decoration-dotted');
            cell.title = '正在获取...';
            cell.onclick = null;
        }

        function fetchAllintitleCount(keyword) {
            allintitleConfig = allintitleConfig || loadAllintitleConfig();
            if (!allintitleConfig.enabled) return Promise.resolve(null);
            if (!allintitleConfig.apiKey || !allintitleConfig.cx) return Promise.resolve(null);

            const q = buildAllintitleQuery(keyword);
            if (!q) return Promise.resolve(null);

            const cacheKey = q;
            const cached = allintitleCache.get(cacheKey);
            if (cached && (Date.now() - cached.ts) < 6 * 60 * 60 * 1000) return Promise.resolve(cached.value);

            if (allintitleInFlight.has(cacheKey)) return allintitleInFlight.get(cacheKey);

            const task = () => {
                const controller = new AbortController();
                const timer = window.setTimeout(() => controller.abort(), 12000);

                const url = new URL('https://www.googleapis.com/customsearch/v1');
                url.searchParams.set('key', allintitleConfig.apiKey);
                url.searchParams.set('cx', allintitleConfig.cx);
                url.searchParams.set('q', q);
                url.searchParams.set('num', '1');
                url.searchParams.set('filter', '0'); 
                url.searchParams.set('safe', 'off'); // 关闭安全搜索过滤
                // url.searchParams.set('nfpr', '1'); // API 不支持 nfpr 参数，移除以防止 400 Error
                
                // 强制使用美国/英语环境，以对齐网页端 manual check 的结果
                // 解决因数据中心不同导致的 19 vs 30 这种差异
                url.searchParams.set('gl', 'us');
                url.searchParams.set('hl', 'en');


                return fetch(url.toString(), { signal: controller.signal })
                    .then(async (res) => {
                        if (!res.ok) {
                            const errorData = await res.json().catch(() => ({}));
                            const msg = errorData.error ? errorData.error.message : `HTTP ${res.status}`;
                            const err = new Error(msg);
                            err.httpStatus = res.status;
                            throw err;
                        }
                        const data = await res.json();
                        
                        // 兼容多种可能的返回结构
                        let raw = null;
                        if (data.searchInformation && data.searchInformation.totalResults !== undefined) {
                            raw = data.searchInformation.totalResults;
                        } else if (data.queries && data.queries.request && data.queries.request[0]) {
                            raw = data.queries.request[0].totalResults;
                        }

                        if (raw === null) {
                            console.warn('Google API 未返回 totalResults:', data);
                            return null;
                        }

                        const value = Number(raw);
                        if (!Number.isFinite(value)) return null;
                        
                        allintitleCache.set(cacheKey, { ts: Date.now(), value });
                        return value;
                    })
                    .finally(() => {
                        window.clearTimeout(timer);
                    });
            };

            const chained = allintitleQueue = allintitleQueue
                .catch(() => null)
                .then(() => task())
                .finally(() => new Promise((r) => window.setTimeout(r, 450)));

            allintitleInFlight.set(cacheKey, chained);
            chained.finally(() => allintitleInFlight.delete(cacheKey));
            return chained;
        }

                function showCenteredAlert(title, message, isConfirm = false, onConfirm = null) {
            const modal = document.getElementById('genericAlertModal');
            const content = document.getElementById('genericAlertContent');
            const titleEl = document.getElementById('genericAlertTitle');
            const msgEl = document.getElementById('genericAlertMessage');
            const cancelBtn = document.getElementById('genericAlertCancelBtn');
            const okBtn = document.getElementById('genericAlertOkBtn');
            
            if(!modal) return alert(message);

            titleEl.innerText = title;
            msgEl.innerText = message;
            
            // Handle buttons
            if (isConfirm) {
                cancelBtn.classList.remove('hidden');
                cancelBtn.onclick = closeGenericAlert;
                
                okBtn.onclick = () => {
                    closeGenericAlert();
                    if (onConfirm) onConfirm();
                };
            } else {
                cancelBtn.classList.add('hidden');
                okBtn.onclick = closeGenericAlert;
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            requestAnimationFrame(() => {
                modal.classList.remove('opacity-0');
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            });
        }

        function showCenteredConfirm(title, message, onConfirm) {
            showCenteredAlert(title, message, true, onConfirm);
        }

        function closeGenericAlert() {
            const modal = document.getElementById('genericAlertModal');
            const content = document.getElementById('genericAlertContent');
            
            modal.classList.add('opacity-0');
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            
            setTimeout(() => {
                modal.classList.remove('flex');
                modal.classList.add('hidden');
            }, 300);
        }

        function scheduleRowAllintitleUpdate(row, keyword) {
            allintitleConfig = allintitleConfig || loadAllintitleConfig();
            if (!allintitleConfig.enabled) return;

            const prev = allintitleRowTimers.get(row);
            if (prev) window.clearTimeout(prev);

            const timer = window.setTimeout(async () => {
                allintitleRowTimers.delete(row);

                allintitleConfig = allintitleConfig || loadAllintitleConfig();
                if (!allintitleConfig.enabled) return;

                if (!allintitleConfig.apiKey || !allintitleConfig.cx) {
                    openAllintitleConfigModal();
                    return;
                }

                setAllintitleLoading(row);
                try {
                    const value = await fetchAllintitleCount(keyword);
                    if (value === null) {
                        setAllintitleCell(row, '-');
                    } else {
                        setAllintitleCell(row, value);
                    }
                } catch (e) {
                    console.error('Allintitle Update Error:', e);

                    const info = describeAllintitleError(e);
                    const isQuotaError = info.code === 'Quota Limit';

                    setAllintitleCell(row, info.code);

                    const cell = row.querySelector('.table-allintitle');
                    if (cell) {
                        cell.title = info.detail || (e.message || '未知错误');
                        cell.classList.add('text-rose-500', 'cursor-pointer', 'underline', 'decoration-dotted');
                        cell.onclick = (evt) => {
                            evt.stopPropagation();
                            if (isQuotaError) {
                                showCenteredConfirm(
                                    info.title,
                                    info.detail,
                                    () => openAllintitleConfigModal()
                                );
                            } else {
                                showCenteredAlert(info.title, info.detail);
                            }
                        };
                    }
                }
            }, 600);

            allintitleRowTimers.set(row, timer);
        }

        function bindTableEvents() {
            document.querySelectorAll('#kgrTable tbody tr').forEach(row => {
                const keywordCell = row.querySelector('td[contenteditable="true"]');
                if (keywordCell && keywordCell.dataset.kgrBound !== '1') {
                    keywordCell.dataset.kgrBound = '1';
                    keywordCell.addEventListener('input', () => {
                        const keyword = keywordCell.innerText.trim();
                        if (keyword) scheduleRowAllintitleUpdate(row, keyword);
                    });
                }

                row.querySelectorAll('[contenteditable="true"]').forEach(cell => {
                    if (cell.dataset.kgrBound === '1') return;
                    cell.dataset.kgrBound = '1';
                    cell.addEventListener('input', () => {
                        if (cell.classList.contains('table-volume') || cell.classList.contains('table-allintitle')) {
                            calculateTableKGR(row);
                        }
                    });
                });
            });
        }

        function runWhenIdle(fn, timeoutMs) {
            if ('requestIdleCallback' in window) {
                window.requestIdleCallback(fn, { timeout: timeoutMs || 2000 });
                return;
            }
            window.setTimeout(fn, 0);
        }

        window.requestAnimationFrame(() => {
            runWhenIdle(() => {
                allintitleConfig = loadAllintitleConfig();
                bindTableEvents();
            }, 2000);

            runWhenIdle(() => {
                loadTrendsLibrary().catch(() => {});
            }, 5000);
        });
    </script>
    <!-- Generic Alert Modal -->
    <div id="genericAlertModal" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm mx-4 transform scale-95 transition-transform duration-300" id="genericAlertContent">
            <div class="p-6 text-center">
                <div class="w-12 h-12 rounded-full bg-rose-100 p-2 mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-rose-500 text-xl"></i>
                </div>
                <h3 class="text-lg font-bold text-slate-800 mb-2" id="genericAlertTitle">提示</h3>
                <p class="text-slate-600 mb-6 text-sm break-words" id="genericAlertMessage">内容</p>
                <div class="flex gap-3 justify-center" id="genericAlertButtons">
                    <button id="genericAlertCancelBtn" onclick="closeGenericAlert()" class="hidden w-full py-2.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-medium transition-colors">
                        取消
                    </button>
                    <button id="genericAlertOkBtn" onclick="closeGenericAlert()" class="w-full py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-colors">
                        确定
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
